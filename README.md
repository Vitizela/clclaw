# 论坛作者订阅归档系统

> **版本**: v1.4-phase4
> **状态**: Phase 4 完成 ✅
> **最后更新**: 2026-02-15

一个基于 Python 的自动化工具，用于订阅和归档论坛作者的帖子内容，支持全量归档、增量更新和**数据分析可视化**。

---

## 🎯 项目特性

### 核心功能
- 🔍 **智能订阅**: 通过帖子链接一键关注作者
- 📦 **自动归档**: 全量下载历史帖子，增量更新新内容
- 🎨 **友好交互**: 菜单式界面，无需记忆命令
- 🔍 **新帖检测**: 快速检测作者新帖，标记和提醒
- ⏰ **定时任务**: 无人值守自动更新
- 🔄 **平滑迁移**: 自动从旧配置迁移

### 数据管理（Phase 3）✨
- 💾 **数据库支持**: SQLite 数据库，快速查询和统计
- 📊 **基础统计**: 全局统计、作者排行、时间分布
- 🔧 **数据完整性**: 自动检查和修复数据问题
- 📈 **归档进度**: 实时显示归档进度和论坛总数

### 数据分析（Phase 4）🎉 NEW
- 📸 **EXIF 分析**: 提取照片元数据，GPS 反查地理位置
- 🔤 **词云生成**: 中文分词与高频词可视化
- 📈 **趋势分析**: 月度发帖趋势图、时间热力图
- 📷 **相机统计**: 相机使用排行榜
- 📊 **HTML 报告**: 精美的可视化分析报告（单文件分享）
- ⚡ **活跃度分析**: 最活跃时段、夜猫子指数等 6 项指标

---

## 📸 界面预览

### 主菜单

```
╔════════════════════════════════════════╗
║   论坛作者订阅归档系统 v1.4            ║
╠════════════════════════════════════════╣
║  当前关注: 9 位作者                    ║
║  论坛版块: thread0806.php?fid=7       ║
║  归档路径: ../论坛存档                 ║
╠════════════════════════════════════════╣
║  [1] 关注新作者 (通过帖子链接)         ║
║  [2] 查看关注列表                      ║
║  [3] 立即更新所有作者                  ║
║  [4] 取消关注作者                      ║
║  [5] 查看统计 ✨                       ║
║  [6] 数据分析 🎉                       ║
║  [7] 系统设置                          ║
║  [0] 退出                              ║
╚════════════════════════════════════════╝
```

### 数据分析菜单

```
╔════════════════════════════════════════╗
║         📊 数据分析                     ║
╚════════════════════════════════════════╝

请选择操作:
  📝 生成作者分析报告
  🌍 生成全局分析报告
  📁 查看已生成的报告
  🔙 返回主菜单
```

### 统计面板

```
╔═══════════════════════════════════════════════════════════════╗
║                       全局统计面板                              ║
╠═══════════════════════════════════════════════════════════════╣
║  关注作者数     │  9 位                                        ║
║  归档帖子总数   │  350 篇                                      ║
║  图片总数       │  1,200 张                                    ║
║  视频总数       │  65 个                                       ║
║  总存储空间     │  2.5 GB                                      ║
║  数据库大小     │  4.7 MB                                      ║
╚═══════════════════════════════════════════════════════════════╝
```

---

## 🚀 快速开始

### 前置要求

- **Python**: 3.10+
- **硬盘空间**: 至少 10GB
- **网络**: 稳定的互联网连接

### 一键安装

```bash
# 1. 克隆项目
git clone <仓库地址>
cd gemini-t66y

# 2. 运行安装脚本
bash install.sh

# 3. 启动系统
cd python
source venv/bin/activate
python main.py
```

### 手动安装（5 分钟）

```bash
# 1. 进入 Python 目录
cd gemini-t66y/python

# 2. 创建并激活虚拟环境
python3 -m venv venv
source venv/bin/activate  # Linux/macOS
# venv\Scripts\activate  # Windows

# 3. 安装依赖
pip install -r requirements.txt

# 4. 安装 Playwright 浏览器
playwright install chromium

# 5. 安装中文字体（Linux，可选）
sudo apt install fonts-wqy-zenhei  # Ubuntu/Debian

# 6. 启动系统
python main.py
```

首次运行会启动配置向导，按提示完成配置。

📖 **详细安装说明**: 参见 [SETUP.md](./SETUP.md)

---

## 📊 项目进度

| Phase | 功能 | 状态 | 进度 | 完成日期 |
|-------|------|------|------|----------|
| **Phase 1** | 基础框架与菜单 | ✅ 完成 | 100% | 2026-02-11 |
| **Phase 2** | Python 爬虫核心 | ✅ 完成 | 100% | 2026-02-13 |
| **Phase 3** | 数据库与统计 | ✅ 完成 | 100% | 2026-02-14 |
| **Phase 4** | 数据分析可视化 | ✅ 完成 | 100% | 2026-02-15 |
| **Phase 5** | 完善与优化 | 🔴 待开始 | 0% | - |

**总体进度**: 80% (Phase 1-4/5 完成)

---

## 🛠️ 技术栈

### 核心技术
- **Python 3.10+** - 主要语言
- **Playwright** - 网页自动化（反爬虫绕过）
- **SQLite 3** - 轻量级数据库
- **Rich** - 终端美化
- **Questionary** - 交互菜单
- **PyYAML** - 配置管理

### 数据分析（Phase 4）
- **Pillow** - 图像处理（EXIF 提取）
- **geopy** - GPS 反查
- **jieba** - 中文分词
- **wordcloud** - 词云生成
- **matplotlib** - 数据可视化
- **seaborn** - 高级可视化
- **pandas** - 数据处理
- **numpy** - 数值计算
- **Jinja2** - HTML 模板

---

## 📖 使用示例

### 1. 关注新作者

```bash
python main.py
# 选择 [1] 关注新作者
# 输入帖子 URL: https://t66y.com/...
# ✓ 成功关注作者: xxx
```

### 2. 查看归档进度

```bash
# 选择 [2] 查看关注列表
┌────┬──────────────┬──────────┬──────────────┬────────┐
│ ID │ 作者名       │ 归档进度 │ 新帖         │ 最后更新│
├────┼──────────────┼──────────┼──────────────┼────────┤
│ 1  │ 同花顺心     │ 80/120   │              │ 今天   │
│    │              │ (67%)    │              │        │
│ 2  │ cyruscc      │ 77/77 ✓  │ 🆕(3)       │ 昨天   │
└────┴──────────────┴──────────┴──────────────┴────────┘
```

### 3. 生成数据分析报告

```bash
# 方法 1: 使用演示脚本（推荐）
python demo_analysis.py              # 全局报告
python demo_analysis.py 同花顺心      # 作者报告

# 方法 2: 交互式菜单
python main.py
# 选择 [6] 数据分析 → 生成作者/全局报告
```

**生成的报告包含**:
- 📊 词云图（高频词可视化）
- 📈 月度发帖趋势图
- 🔥 时间热力图（7×24 小时）
- 📷 相机使用排行
- ⚡ 活跃度分析（6 项指标）
- 📸 EXIF 信息（GPS 位置、相机型号等）

**报告特点**:
- 单文件 HTML（图表 base64 嵌入）
- 响应式设计（手机/平板/桌面）
- 精美渐变配色
- 支持打印

### 4. 查看统计数据

```bash
# 选择 [5] 查看统计
# 可选择：
#   - 全局统计
#   - 作者排行榜
#   - 月度统计
#   - 时间分布统计
#   - 搜索帖子
#   - 数据完整性检查
```

---

## 🗂️ 项目结构

```
gemini-t66y/
├── python/                  # Python 版本（主要）
│   ├── main.py             # 主入口
│   ├── requirements.txt    # Python 依赖
│   ├── config.yaml         # 配置文件
│   │
│   ├── src/                # 源代码
│   │   ├── config/         # 配置管理
│   │   ├── menu/           # 菜单系统
│   │   │   ├── main_menu.py       # 主菜单
│   │   │   └── analysis_menu.py   # 分析菜单 ✨
│   │   ├── bridge/         # Node.js 桥接（临时）
│   │   ├── scraper/        # 爬虫核心 ✅
│   │   │   ├── extractor.py       # 帖子提取
│   │   │   ├── downloader.py      # 内容下载
│   │   │   └── archiver.py        # 归档管理
│   │   ├── data/           # 数据追踪 ✅
│   │   ├── database/       # 数据库 ✅
│   │   │   ├── schema.sql          # 数据库结构
│   │   │   ├── models.py           # ORM 模型
│   │   │   ├── query.py            # 查询功能
│   │   │   ├── sync.py             # 数据同步
│   │   │   ├── migrate.py          # 数据迁移
│   │   │   └── integrity.py        # 完整性检查
│   │   ├── analysis/       # 数据分析 ✨ NEW
│   │   │   ├── exif_analyzer.py    # EXIF 分析
│   │   │   ├── text_analyzer.py    # 文本分析
│   │   │   ├── time_analyzer.py    # 时间分析
│   │   │   ├── visualizer.py       # 可视化器
│   │   │   └── report_generator.py # 报告生成
│   │   ├── templates/      # HTML 模板
│   │   │   ├── post.html           # 帖子模板
│   │   │   └── analysis_report.html # 分析报告模板
│   │   └── utils/          # 工具函数
│   │       ├── font_config.py      # 字体配置
│   │       └── stopwords.txt       # 停用词表
│   │
│   ├── data/               # 数据目录
│   │   ├── forum_data.db   # SQLite 数据库
│   │   ├── analysis/       # 分析图表 ✨
│   │   └── reports/        # HTML 报告 ✨
│   │
│   ├── test_*.py           # 测试脚本
│   ├── demo_analysis.py    # 分析演示脚本 ✨
│   └── 分析功能使用说明.md  # 分析功能文档 ✨
│
├── 论坛存档/               # 归档内容（.gitignore）
├── logs/                   # 日志（.gitignore）
│
└── [文档]
    ├── README.md           # 本文档
    ├── SETUP.md            # 安装配置指南
    ├── ADR-002*.md         # 架构决策
    ├── MIGRATION_*.md      # 迁移指南
    ├── PHASE*_*.md         # 各阶段文档
    └── GIT_GUIDE.md        # Git 指南
```

---

## 📚 文档导航

### 快速入门
- **[README.md](./README.md)** - 本文档（项目概述）
- **[SETUP.md](./SETUP.md)** - 详细安装配置指南 ⭐
- **[python/分析功能使用说明.md](./python/分析功能使用说明.md)** - 数据分析功能指南

### 项目设计
- **[PROJECT_OVERVIEW.md](./PROJECT_OVERVIEW.md)** - 项目总览
- **[ADR-001](./ADR-001_Phase1_Forum_Scraping_Plan.md)** - 初始架构（Node.js）
- **[ADR-002](./ADR-002_Python_Migration_Plan.md)** - Python 迁移方案

### 阶段文档

**Phase 1** (基础框架):
- [PHASE1_COMPLETED.md](./PHASE1_COMPLETED.md) - 完成总结
- [PHASE1_TESTING.md](./PHASE1_TESTING.md) - 测试指南

**Phase 2** (爬虫核心):
- [python/PHASE2_COMPLETION_REPORT.md](./python/PHASE2_COMPLETION_REPORT.md) - 完成报告
- [PHASE2_API_MAPPING.md](./PHASE2_API_MAPPING.md) - Playwright API 对照

**Phase 3** (数据库):
- [PHASE3_COMPLETION_REPORT.md](./PHASE3_COMPLETION_REPORT.md) - 完成报告
- [PHASE3_DETAILED_PLAN.md](./PHASE3_DETAILED_PLAN.md) - 详细计划

**Phase 4** (数据分析):
- [python/PHASE4_WEEK1_EXIF.md](./python/PHASE4_WEEK1_EXIF.md) - EXIF 功能文档
- [python/PHASE4_WEEK2_PLAN.md](./python/PHASE4_WEEK2_PLAN.md) - Week 2 实施计划
- [python/PHASE4_WEEK3_PLAN.md](./python/PHASE4_WEEK3_PLAN.md) - Week 3 实施计划

### 故障排查
- **[python/中文字体问题解决方案.md](./python/中文字体问题解决方案.md)** - 字体问题排查指南
- **[ANTI_CRAWLER_ISSUE.md](./ANTI_CRAWLER_ISSUE.md)** - 反爬虫问题分析

---

## 🎨 数据分析示例

### 生成的图表

<details>
<summary>点击查看图表示例说明</summary>

#### 1. 词云图
- **文件**: `wordcloud_作者名.png`
- **内容**: 帖子标题高频词可视化
- **特点**: 中文分词、停用词过滤、300 DPI 高清

#### 2. 月度趋势图
- **文件**: `monthly_trend_全局.png`
- **内容**: 按月统计发帖数量
- **用途**: 查看发帖趋势和活跃度变化

#### 3. 时间热力图
- **文件**: `time_heatmap_全局.png`
- **内容**: 7×24 热力图（星期 × 小时）
- **用途**: 发现最活跃的时间段

#### 4. 相机排行图
- **文件**: `camera_ranking.png`
- **内容**: 使用最多的相机 Top 10
- **数据来源**: 照片 EXIF 元数据

#### 5. HTML 报告
- **文件**: `report_全局_时间戳.html`
- **内容**: 包含所有图表和统计的完整报告
- **特点**: 单文件、响应式、精美配色

</details>

### 活跃度指标

分析报告中包含以下 6 项活跃度指标：

| 指标 | 说明 | 示例 |
|------|------|------|
| **最活跃小时** | 一天中发帖最多的小时 | 16:00 |
| **最活跃星期** | 一周中发帖最多的星期 | 周四 |
| **周末占比** | 周六+周日发帖占总数的比例 | 25.3% |
| **夜猫子指数** | 22:00-6:00 发帖占比 | 28.4% |
| **早起指数** | 6:00-9:00 发帖占比 | 0.0% |
| **工作日指数** | 周一至周五 9:00-18:00 发帖占比 | 50.7% |

---

## 🤝 参与开发

### 开发流程

```bash
# 1. 切换到开发分支
git checkout dev

# 2. 创建功能分支
git checkout -b feature/your-feature

# 3. 开发并测试
# ... 编辑代码 ...
python test_*.py  # 运行测试

# 4. 提交变更
git add .
git commit -m "feat: 描述你的变更"

# 5. 合并到 dev
git checkout dev
git merge feature/your-feature --no-ff

# 6. Phase 完成后合并到 main
git checkout main
git merge dev --no-ff
git tag -a v1.x-phaseX -m "Phase X 完成"
```

详见 [GIT_GUIDE.md](./GIT_GUIDE.md)

---

## 📝 变更日志

### v1.4-phase4 (2026-02-15) 🎉 最新

**Phase 4 Week 1 - EXIF 提取与显示**:
- ✅ EXIF 元数据提取（Pillow + ExifAnalyzer）
- ✅ GPS 反查地理位置（geopy）
- ✅ 数据库 schema 扩展（10 个 EXIF 字段）
- ✅ 实时同步（归档时自动提取）
- ✅ 批量迁移工具（migrate_exif.py）
- ✅ HTML 静态显示（模板 v2.7）

**Phase 4 Week 2 - 文本与时间分析**:
- ✅ TextAnalyzer（中文分词、词云生成）
- ✅ TimeAnalyzer（月度趋势、时间热力图、活跃度分析）
- ✅ FontConfig（跨平台中文字体检测）
- ✅ 停用词表（200+ 中文停用词）
- ✅ 相机排行统计

**Phase 4 Week 3 - 可视化与报告**:
- ✅ Visualizer（统一可视化接口）
- ✅ ReportGenerator（HTML 报告生成器）
- ✅ AnalysisMenu（交互式分析菜单）
- ✅ 主菜单集成
- ✅ 演示工具（demo_analysis.py）

**代码统计**:
- Phase 4 Week 1: +1,661 行（EXIF 功能）
- Phase 4 Week 2: +1,636 行（文本与时间分析）
- Phase 4 Week 3: +1,735 行（可视化与报告）
- **Phase 4 总计**: +5,032 行

**测试**:
- Week 1: 自动同步测试通过
- Week 2: 8/8 测试通过（100%）
- Week 3: 4/4 测试通过（100%）

**文档**:
- ✅ 3 个 Week 实施计划
- ✅ 分析功能使用说明
- ✅ 中文字体问题解决方案
- ✅ 完整的测试脚本

---

### v1.3-phase3 (2026-02-14)

**新增功能**:
- ✅ SQLite 数据库支持（4 表 + 14 索引 + 2 视图 + 3 触发器）
- ✅ 轻量级 ORM（Author/Post/Media 模型）
- ✅ 历史数据导入工具（350 篇 < 15 秒）
- ✅ 7 种统计查询功能
- ✅ 实时数据同步
- ✅ 数据完整性检查
- ✅ 统计菜单重构

**测试**: 71/71 通过（100%）

---

### v1.2-phase2 (2026-02-13)

**新增功能**:
- ✅ Python 爬虫核心（extractor, downloader, archiver）
- ✅ 归档进度显示
- ✅ 刷新检测新帖（NF-001）
- ✅ 菜单循环重构（UX-003）

---

### v1.0-phase1 (2026-02-11)

**新增功能**:
- ✅ 配置管理系统（YAML）
- ✅ 交互式菜单系统
- ✅ 配置向导
- ✅ Node.js 脚本桥接

---

## 🐛 已知问题

### Phase 4 已知问题

1. **中文字体问题** ⚠️
   - **问题**: 相机排行图可能显示方块
   - **原因**: 系统缺少完整的中文字体
   - **解决**: 参考 [python/中文字体问题解决方案.md](./python/中文字体问题解决方案.md)
   - **快速修复**: `python fix_camera_ranking.py`

2. **反爬虫检测** ⚠️
   - **问题**: 刷新检测功能可能被反爬虫阻止
   - **影响**: 无法统计论坛总帖子数
   - **状态**: 暂不修复（Phase 2 遗留）
   - **详见**: [ANTI_CRAWLER_ISSUE.md](./ANTI_CRAWLER_ISSUE.md)

### 修复记录

- ✅ **Phase 4 Bug #1**: EXIF 数据库同步问题（5 个连锁 bug）- 已修复
- ✅ **Phase 1-3 所有 bug** - 已修复

---

## 📊 项目统计

### 代码规模

| Phase | 核心代码 | 测试代码 | 文档 | 提交 |
|-------|----------|----------|------|------|
| Phase 1 | 1,103 行 | - | 8,500 行 | 2 |
| Phase 2 | 2,200 行 | 300 行 | 12,000 行 | 5 |
| Phase 3 | 3,100 行 | 500 行 | 15,000 行 | 2 |
| Phase 4 | 5,032 行 | 800 行 | 18,000 行 | 3 |
| **总计** | **11,435 行** | **1,600 行** | **53,500 行** | **12** |

### 性能指标

| 指标 | 目标 | 实际 | 状态 |
|------|------|------|------|
| 数据库导入（350 篇） | < 15s | 10-12s | ✅ 超越 |
| 查询全局统计 | < 1s | 0.05s | ✅ 超越 |
| 生成词云（快速） | < 2s | 1-2s | ✅ 达标 |
| 生成报告（全局） | < 30s | 15-20s | ✅ 超越 |
| 数据库大小（350 篇） | < 10MB | 4.7MB | ✅ 超越 |
| 报告大小（HTML） | < 1MB | 0.25-0.28MB | ✅ 超越 |

---

## 📄 许可证

本项目仅供学习研究使用。

---

## 🔗 相关链接

- **项目仓库**: 本地仓库
- **文档索引**: [DOCS_INDEX.md](./DOCS_INDEX.md)
- **安装指南**: [SETUP.md](./SETUP.md) ⭐
- **问题反馈**: 见各 Phase 测试文档

---

## 🙏 致谢

感谢 **Claude Sonnet 4.5** 协助开发和文档编写。

---

## 🎯 下一步计划

### Phase 5: 完善与优化（待开始）

计划功能：
- 🔧 命令行模式完善（非交互式命令）
- 📝 日志系统优化（结构化日志、日志级别）
- ⚠️ 错误处理改进（友好提示、自动重试）
- 🚀 性能优化（内存、并发、缓存）
- 🔐 安全加固（输入验证、权限控制）
- 📦 打包与分发（pip 包、Docker）

---

**最后更新**: 2026-02-15
**当前版本**: v1.4-phase4
**下一目标**: Phase 5 - 完善与优化

**Phase 4 亮点**:
- 📊 完整的数据分析可视化系统
- 🎨 精美的 HTML 报告（单文件分享）
- 📸 EXIF 元数据提取与 GPS 反查
- 🔤 中文文本分析与词云生成
- 📈 时间趋势分析与热力图
- ⚡ 6 项活跃度指标分析
- ✅ 12/12 测试全部通过（100%）
