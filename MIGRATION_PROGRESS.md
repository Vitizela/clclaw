# Python 迁移进度追踪

> **开始日期**: 2026-02-11
> **当前阶段**: Phase 1 - 基础框架
> **整体进度**: 0% (0/135 任务)

---

## 📊 总体进度

```
Phase 1: ████░░░░░░░░░░░░░░░░  0% (0/35)
Phase 2: ░░░░░░░░░░░░░░░░░░░░  0% (0/40)
Phase 3: ░░░░░░░░░░░░░░░░░░░░  0% (0/25)
Phase 4: ░░░░░░░░░░░░░░░░░░░░  0% (0/30)
Phase 5: ░░░░░░░░░░░░░░░░░░░░  0% (0/15)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
总计:    ░░░░░░░░░░░░░░░░░░░░  0% (0/145)
```

---

## Phase 1: 基础框架 (0/35)

**目标**: 建立 Python 项目，实现菜单系统，桥接 Node.js
**预计**: 2-3 天
**状态**: 🔴 未开始
**开始**: -
**完成**: -

### 1.1 环境搭建 (0/5)

- [ ] P1.1.1 创建 `python/` 目录结构
- [ ] P1.1.2 创建所有 `__init__.py` 文件
- [ ] P1.1.3 编写 `requirements.txt` (Phase 1 版本)
- [ ] P1.1.4 创建虚拟环境
- [ ] P1.1.5 安装所有依赖

**验证**:
```bash
tree python -I '__pycache__'
pip list | grep -E "(PyYAML|questionary|rich|click)"
```

### 1.2 配置管理 (0/8)

- [ ] P1.2.1 创建 `src/config/__init__.py`
- [ ] P1.2.2 实现 `ConfigManager` 类
  - [ ] P1.2.2.1 `load()` 方法
  - [ ] P1.2.2.2 `save()` 方法
  - [ ] P1.2.2.3 `config_exists()` 方法
  - [ ] P1.2.2.4 `_migrate_from_json()` 方法
  - [ ] P1.2.2.5 `_merge_with_defaults()` 方法
  - [ ] P1.2.2.6 `add_author()` 方法
  - [ ] P1.2.2.7 `remove_author()` 方法
- [ ] P1.2.3 实现 `ConfigWizard` 类
  - [ ] P1.2.3.1 `run()` 主流程
  - [ ] P1.2.3.2 `_configure_forum()` 方法
  - [ ] P1.2.3.3 `_configure_storage()` 方法
  - [ ] P1.2.3.4 `_configure_analysis()` 方法
  - [ ] P1.2.3.5 `_configure_schedule()` 方法
- [ ] P1.2.4 单元测试：配置加载
- [ ] P1.2.5 单元测试：配置保存
- [ ] P1.2.6 单元测试：JSON 迁移
- [ ] P1.2.7 集成测试：完整配置流程
- [ ] P1.2.8 文档：配置文件说明注释

**验证**:
```bash
python3 -c "from src.config.manager import ConfigManager; cm = ConfigManager(); print('✓')"
```

### 1.3 桥接模块 (0/6)

- [ ] P1.3.1 创建 `src/bridge/__init__.py`
- [ ] P1.3.2 实现 `NodeJSBridge` 类
  - [ ] P1.3.2.1 `__init__()` - 路径初始化
  - [ ] P1.3.2.2 `follow_author()` 方法
  - [ ] P1.3.2.3 `archive_posts()` 方法
  - [ ] P1.3.2.4 `run_update()` 方法
  - [ ] P1.3.2.5 `discover_authors()` 方法
  - [ ] P1.3.2.6 `_run_script()` 核心方法
- [ ] P1.3.3 单元测试：路径解析
- [ ] P1.3.4 集成测试：调用 Node.js 脚本
- [ ] P1.3.5 错误处理：脚本不存在
- [ ] P1.3.6 错误处理：执行失败

**验证**:
```bash
cd python
python3 -c "from src.bridge.nodejs_bridge import NodeJSBridge; b = NodeJSBridge(); print('✓')"
```

### 1.4 菜单系统 (0/12)

- [ ] P1.4.1 创建 `src/menu/__init__.py`
- [ ] P1.4.2 实现 `MainMenu` 类
  - [ ] P1.4.2.1 `__init__()` 初始化
  - [ ] P1.4.2.2 `run()` 主循环
  - [ ] P1.4.2.3 `_show_status()` 状态显示
  - [ ] P1.4.2.4 `_show_main_menu()` 主菜单
  - [ ] P1.4.2.5 `_follow_author()` 关注作者
  - [ ] P1.4.2.6 `_view_followed_authors()` 查看列表
  - [ ] P1.4.2.7 `_run_update()` 执行更新
  - [ ] P1.4.2.8 `_unfollow_author()` 取消关注
  - [ ] P1.4.2.9 `_show_settings()` 设置菜单
  - [ ] P1.4.2.10 `_edit_forum_url()` 修改 URL
  - [ ] P1.4.2.11 `_edit_archive_path()` 修改路径
  - [ ] P1.4.2.12 `_edit_download_options()` 下载选项
- [ ] P1.4.3 占位功能：统计信息
- [ ] P1.4.4 占位功能：数据分析
- [ ] P1.4.5 界面美化：Rich 样式
- [ ] P1.4.6 界面美化：表格显示

**验证**:
```bash
python main.py  # 应显示菜单
```

### 1.5 CLI 框架 (0/2)

- [ ] P1.5.1 创建 `src/cli/__init__.py`
- [ ] P1.5.2 实现 `CLI` 类（简化版）

### 1.6 主入口 (0/4)

- [ ] P1.6.1 创建 `python/main.py`
- [ ] P1.6.2 实现主入口逻辑
- [ ] P1.6.3 命令行参数解析（简单版）
- [ ] P1.6.4 菜单/CLI 模式分发

**验证**:
```bash
python main.py        # 菜单模式
python main.py list   # CLI 模式（占位）
```

### 1.7 测试与验证 (0/8)

- [ ] P1.7.1 测试：首次运行配置向导
- [ ] P1.7.2 测试：config.json 迁移
- [ ] P1.7.3 测试：菜单导航
- [ ] P1.7.4 测试：关注新作者（桥接）
- [ ] P1.7.5 测试：查看关注列表
- [ ] P1.7.6 测试：立即更新（桥接）
- [ ] P1.7.7 测试：取消关注
- [ ] P1.7.8 测试：系统设置修改

### 1.8 文档 (0/3)

- [ ] P1.8.1 代码注释完整性检查
- [ ] P1.8.2 README 更新（可选）
- [ ] P1.8.3 CHANGELOG 记录

---

## Phase 2: Python 爬虫核心 (0/40)

**目标**: 用 Python 实现爬虫，替换 Node.js
**预计**: 5-7 天
**状态**: 🔴 未开始

### 2.1 依赖更新 (0/3)

- [ ] P2.1.1 更新 `requirements.txt` (添加 Playwright, aiohttp, beautifulsoup4, tqdm)
- [ ] P2.1.2 安装 Playwright 浏览器: `playwright install chromium`
- [ ] P2.1.3 创建依赖检查脚本 `python/check_dependencies.py`

**验证**:
```bash
python check_dependencies.py
# 应显示所有依赖已就绪
```

### 2.2 爬虫核心 (0/22)

- [ ] P2.2.1 创建 `src/scraper/__init__.py`
- [ ] P2.2.2 实现 `src/scraper/utils.py` 工具函数 🔴 P0
  - [ ] P2.2.2.1 `sanitize_filename()` - 必须与 Node.js 完全一致
  - [ ] P2.2.2.2 `check_post_exists()` - 改进的增量检查
  - [ ] P2.2.2.3 `mark_post_complete()` - 完整性标记
  - [ ] P2.2.2.4 `build_post_path()` - 路径构建
  - [ ] P2.2.2.5 单元测试（与 Node.js 对比）
- [ ] P2.2.3 实现 `src/utils/logger.py` 日志系统
  - [ ] P2.2.3.1 `setup_logger()` 初始化
  - [ ] P2.2.3.2 `get_logger()` 获取实例
  - [ ] P2.2.3.3 日志轮转配置
- [ ] P2.2.4 实现 `Extractor` 类
  - [ ] P2.2.4.1 `extract_metadata()` 提取元数据
  - [ ] P2.2.4.2 `extract_content()` 提取内容
  - [ ] P2.2.4.3 `extract_media()` 提取媒体
  - [ ] P2.2.4.4 HTML 清理（BeautifulSoup）
- [ ] P2.2.5 实现 `Downloader` 类
  - [ ] P2.2.5.1 `download_batch()` 批量下载
  - [ ] P2.2.5.2 `_download_single()` 单文件下载
  - [ ] P2.2.5.3 并发控制（Semaphore）
  - [ ] P2.2.5.4 重试机制
  - [ ] P2.2.5.5 进度显示（tqdm）
- [ ] P2.2.6 实现 `Archiver` 类
  - [ ] P2.2.6.1 `__init__()` 初始化（注意路径计算）
  - [ ] P2.2.6.2 `archive_authors()` 主方法
  - [ ] P2.2.6.3 `_collect_posts()` 收集链接
  - [ ] P2.2.6.4 `_archive_post()` 归档单帖
  - [ ] P2.2.6.5 `_generate_markdown()` 生成 Markdown
- [ ] P2.2.7 实现 `Follower` 类
  - [ ] P2.2.7.1 `follow()` 关注作者
  - [ ] P2.2.7.2 提取作者逻辑
  - [ ] P2.2.7.3 触发首次归档

**验证**:
```bash
# 文件名安全化测试（P0）
python -c "from src.scraper.utils import sanitize_filename; assert sanitize_filename('标题<含>特殊:字符') == '标题_含_特殊_字符'"

# 增量检查测试
python tests/test_incremental_check.py
```

### 2.3 测试对比 (0/10)

- [ ] P2.3.1 对比测试工具
- [ ] P2.3.2 测试：帖子收集一致性
- [ ] P2.3.3 测试：内容提取一致性
- [ ] P2.3.4 测试：媒体下载一致性
- [ ] P2.3.5 测试：Markdown 格式一致性
- [ ] P2.3.6 测试：增量逻辑一致性
- [ ] P2.3.7 性能测试
- [ ] P2.3.8 边界情况测试
- [ ] P2.3.9 错误处理测试
- [ ] P2.3.10 完整流程测试

### 2.4 集成替换 (0/7)

- [ ] P2.4.1 配置开关实现
  - [ ] `experimental.use_python_scraper`
  - [ ] `experimental.fallback_to_nodejs`（可选）
- [ ] P2.4.2 菜单集成 Python 爬虫
  - [ ] 修改 `_run_update()` 方法
  - [ ] 修改 `_follow_author()` 方法
  - [ ] 添加回退逻辑
- [ ] P2.4.3 双版本并行测试
- [ ] P2.4.4 创建迁移验证工具 `validate_phase2.py`
  - [ ] 帖子收集一致性检查
  - [ ] 内容提取一致性检查
  - [ ] 生成验证报告
- [ ] P2.4.5 完全切换到 Python 版本
  - [ ] `use_python_scraper` 改为 `true`
  - [ ] 所有功能验证通过
- [ ] P2.4.6 清理 Node.js 桥接代码
  - [ ] 删除 `src/bridge/nodejs_bridge.py`
  - [ ] 从 `main_menu.py` 移除桥接相关代码
  - [ ] 从 `config.yaml` 移除 `legacy` 配置节
  - [ ] 更新文档移除 Node.js 相关说明

**验证**:
```bash
# 迁移验证
python validate_phase2.py
# 应显示所有测试通过

# 完整功能测试
python main.py
# 手动测试所有菜单功能
```
- [ ] P2.4.4 完全切换到 Python
- [ ] P2.4.5 删除/注释桥接模块

### 2.5 文档 (0/5)

- [ ] P2.5.1 代码注释完整性检查
  - [ ] 所有公共类/方法有 docstring
  - [ ] 关键逻辑有注释说明
- [ ] P2.5.2 更新 README.md
  - [ ] 移除 Node.js 相关说明
  - [ ] 更新依赖列表
  - [ ] 更新快速开始指南
- [ ] P2.5.3 更新 CHANGELOG.md
  - [ ] 记录 Phase 2 完成日期
  - [ ] 列出主要变更
- [ ] P2.5.4 验证所有文档链接有效
- [ ] P2.5.5 更新项目进度表

**验证**:
```bash
# 检查文档
grep -r "Node.js 脚本" README.md  # 应该没有输出

# 检查注释覆盖率
python -c "import ast; ..."  # 可选
```

---

## Phase 3: 数据库 + 基础统计 (0/25)

**目标**: 建立数据层，支持统计查询
**预计**: 3-4 天
**状态**: 🔴 未开始

### 3.1 数据库设计 (0/5)

- [ ] P3.1.1 创建 `src/database/__init__.py`
- [ ] P3.1.2 编写 `schema.sql`
- [ ] P3.1.3 设计索引
- [ ] P3.1.4 设计触发器
- [ ] P3.1.5 数据库初始化脚本

### 3.2 数据模型 (0/8)

- [ ] P3.2.1 实现 `Database` 类
  - [ ] P3.2.1.1 连接管理
  - [ ] P3.2.1.2 `create_tables()` 方法
  - [ ] P3.2.1.3 `insert_post()` 方法
  - [ ] P3.2.1.4 `insert_author()` 方法
  - [ ] P3.2.1.5 `insert_media()` 方法
  - [ ] P3.2.1.6 事务处理
- [ ] P3.2.2 实现 `Query` 工具类
  - [ ] P3.2.2.1 `get_posts()` 查询
  - [ ] P3.2.2.2 `get_authors()` 查询
  - [ ] P3.2.2.3 `get_stats()` 统计
  - [ ] P3.2.2.4 复杂查询优化

### 3.3 数据同步 (0/5)

- [ ] P3.3.1 归档时写入数据库
- [ ] P3.3.2 数据一致性检查
- [ ] P3.3.3 历史数据导入工具
- [ ] P3.3.4 导入进度显示
- [ ] P3.3.5 导入验证

### 3.4 基础统计 (0/6)

- [ ] P3.4.1 总体统计实现
- [ ] P3.4.2 作者排行实现
- [ ] P3.4.3 时间分布统计
- [ ] P3.4.4 媒体统计
- [ ] P3.4.5 统计缓存机制
- [ ] P3.4.6 菜单集成统计功能

### 3.5 测试 (0/3)

- [ ] P3.5.1 数据库操作测试
- [ ] P3.5.2 数据导入测试
- [ ] P3.5.3 统计准确性测试

---

## Phase 4: 数据分析 + 可视化 (0/30)

**目标**: 实现核心分析功能
**预计**: 5-7 天
**状态**: 🔴 未开始

### 4.1 依赖更新 (0/2)

- [ ] P4.1.1 更新 `requirements.txt` (分析库)
- [ ] P4.1.2 安装中文字体

### 4.2 文本分析 (0/8)

- [ ] P4.2.1 创建 `src/analysis/__init__.py`
- [ ] P4.2.2 jieba 分词集成
- [ ] P4.2.3 停用词加载
- [ ] P4.2.4 词频统计
- [ ] P4.2.5 词云生成器
- [ ] P4.2.6 词云配置（字体、颜色）
- [ ] P4.2.7 多作者词云对比
- [ ] P4.2.8 测试中文显示

### 4.3 时间分析 (0/6)

- [ ] P4.3.1 发帖频率分析
- [ ] P4.3.2 小时分布分析
- [ ] P4.3.3 星期分布分析
- [ ] P4.3.4 月度趋势分析
- [ ] P4.3.5 活跃时段识别
- [ ] P4.3.6 时间模式可视化

### 4.4 可视化 (0/8)

- [ ] P4.4.1 matplotlib 配置
- [ ] P4.4.2 趋势图生成
- [ ] P4.4.3 热力图生成
- [ ] P4.4.4 分布图生成
- [ ] P4.4.5 对比图生成
- [ ] P4.4.6 图表美化
- [ ] P4.4.7 中文字体配置
- [ ] P4.4.8 导出高清图片

### 4.5 报告生成 (0/5)

- [ ] P4.5.1 HTML 模板设计
- [ ] P4.5.2 Jinja2 集成
- [ ] P4.5.3 报告数据准备
- [ ] P4.5.4 图表嵌入
- [ ] P4.5.5 Markdown 报告（可选）

### 4.6 菜单集成 (0/3)

- [ ] P4.6.1 分析菜单实现
- [ ] P4.6.2 参数配置界面
- [ ] P4.6.3 报告查看功能

---

## Phase 5: 完善与优化 (0/15)

**目标**: 完善系统，清理代码
**预计**: 2-3 天
**状态**: 🔴 未开始

### 5.1 命令行完善 (0/5)

- [ ] P5.1.1 Click 命令定义
- [ ] P5.1.2 所有子命令实现
- [ ] P5.1.3 参数验证
- [ ] P5.1.4 帮助文档
- [ ] P5.1.5 自动补全（可选）

### 5.2 日志系统 (0/3)

- [ ] P5.2.1 日志配置
- [ ] P5.2.2 日志轮转
- [ ] P5.2.3 错误追踪

### 5.3 错误处理 (0/3)

- [ ] P5.3.1 网络失败重试
- [ ] P5.3.2 断点续传
- [ ] P5.3.3 优雅降级

### 5.4 性能优化 (0/2)

- [ ] P5.4.1 并发下载优化
- [ ] P5.4.2 数据库查询优化

### 5.5 文档 (0/3)

- [ ] P5.5.1 README 完善
- [ ] P5.5.2 用户手册
- [ ] P5.5.3 FAQ

### 5.6 清理 (0/2)

- [ ] P5.6.1 删除桥接模块
- [ ] P5.6.2 清理 Node.js 脚本（可选）

---

## 📅 时间线

```
Week 1: Phase 1  ████████████████████
Week 2: Phase 2  ████████████████████
Week 3: Phase 2  ████████████████████
Week 4: Phase 3  ████████████████████
Week 5: Phase 4  ████████████████████
Week 6: Phase 4  ████████████████████
Week 7: Phase 5  ████████████████████
```

---

## 🎯 关键里程碑

- [ ] **M1**: Phase 1 完成 - 菜单系统可用
- [ ] **M2**: Phase 2 完成 - Python 爬虫与 Node.js 功能对等
- [ ] **M3**: Phase 3 完成 - 数据库建立，统计可查询
- [ ] **M4**: Phase 4 完成 - 词云和趋势图生成成功
- [ ] **M5**: Phase 5 完成 - 系统完整上线

---

## 📝 变更日志

| 日期 | 操作 | 说明 |
|------|------|------|
| 2026-02-11 | 创建 | 初始进度追踪文档 |

---

**更新此文档**: 每完成一个任务，在对应的 `[ ]` 中标记为 `[x]`
