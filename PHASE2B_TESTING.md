# Phase 2-B 测试指南

> **测试阶段**: Phase 2-B
> **测试日期**: 2026-02-11
> **测试环境**: Linux, Python 3.10+, questionary 2.0.1, rich 13.7.0
> **测试状态**: 📋 待测试

---

## 📋 测试概述

Phase 2-B 引入了 4 个核心改进，需要全面测试以确保功能正确性和用户体验。

### 测试范围

| 类别 | 测试项数量 | 优先级 |
|------|-----------|--------|
| 功能测试 | 12 | P0 |
| 用户体验测试 | 8 | P1 |
| 边界条件测试 | 10 | P0 |
| 兼容性测试 | 4 | P1 |
| 回归测试 | 6 | P2 |
| **总计** | **40** | - |

---

## 🎨 测试 1: 颜色主题改进

### 目标
验证菜单颜色主题已从紫蓝色改为明亮黄色

### 前置条件
- Phase 2-B 代码已实施
- Python 环境正常

### 测试步骤

#### TC1.1: 主菜单颜色
```bash
cd /home/ben/gemini-work/gemini-t66y/python
python main.py
```

**预期结果**:
- [ ] 指针 `❯` 显示为金黄色（接近 `#FFD700`）
- [ ] 当前高亮选项显示为金黄色
- [ ] 问号 `?` 显示为金黄色
- [ ] 对比度明显，易于识别

**实际结果**: _____________

---

#### TC1.2: 多选界面颜色
```bash
# 进入主菜单
选择 "🔄 立即更新"
观察多选界面颜色
```

**预期结果**:
- [ ] 指针 `❯` 为金黄色
- [ ] 高亮选项为金黄色
- [ ] 已勾选的 `[✓]` 为橙黄色（`#FFA500`）
- [ ] 未勾选的 `[ ]` 为正常颜色

**实际结果**: _____________

---

#### TC1.3: 其他交互界面颜色
```bash
# 测试其他菜单
1. 关注新作者 → 输入提示
2. 系统设置 → 选择菜单
3. 取消关注 → 选择作者
```

**预期结果**:
- [ ] 所有选择菜单统一使用金黄色
- [ ] 文本输入框的问号为金黄色
- [ ] 确认对话框的指针为金黄色

**实际结果**: _____________

---

#### TC1.4: 终端兼容性测试

**测试不同终端**:
- [ ] GNOME Terminal（默认黑色背景）
- [ ] Konsole（KDE 终端）
- [ ] xterm（轻量终端）
- [ ] tmux 中的终端

**预期结果**: 在所有终端中颜色都清晰可见

**实际结果**: _____________

---

## 📋 测试 2: 显示作者列表

### 目标
验证更新前正确显示作者列表表格

### 前置条件
- 至少关注 2 位作者
- 配置文件包含作者信息

### 测试步骤

#### TC2.1: 显示完整作者表格
```bash
选择 "🔄 立即更新"
```

**预期结果**:
- [ ] 显示标题: "当前关注 N 位作者"
- [ ] 显示表格列: 序号、作者名、上次更新、关注日期、帖子数、标签
- [ ] 所有作者都在表格中
- [ ] 表格对齐正确，无错位

**表格示例**:
```
当前关注的作者:

┏━━━━┳━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┳━━━━━━━━━━┳━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃ 序号 ┃ 作者名      ┃ 上次更新         ┃ 关注日期  ┃ 帖子数 ┃ 标签               ┃
┡━━━━╇━━━━━━━━━━━╇━━━━━━━━━━━━━━━━╇━━━━━━━━━━╇━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│  1 │ 独醉笑清风  │ 02-11 22:30     │ 2026-02-11│  78  │ synced_from_nodejs │
│  2 │ 清风皓月    │ 02-11 22:35     │ 2026-02-11│  45  │ synced_from_nodejs │
└────┴───────────┴────────────────┴──────────┴──────┴──────────────────┘
```

**实际结果**: _____________

---

#### TC2.2: 无作者时的处理
```bash
# 临时删除所有作者（备份配置）
编辑 config.yaml，清空 followed_authors
选择 "🔄 立即更新"
```

**预期结果**:
- [ ] 显示警告面板: "暂无关注的作者，无需更新"
- [ ] 不显示作者表格
- [ ] 不进入多选界面
- [ ] 提示"按任意键返回"

**实际结果**: _____________

**清理**: 恢复配置文件

---

#### TC2.3: 作者信息完整性
```bash
选择 "🔄 立即更新"
检查表格中的每一列
```

**预期结果**:
- [ ] 序号: 从 1 开始递增
- [ ] 作者名: 显示正确的作者名
- [ ] 上次更新: 格式为 `MM-DD HH:MM`（如果有）
- [ ] 关注日期: 格式为 `YYYY-MM-DD`
- [ ] 帖子数: 显示数字（0 或实际数量）
- [ ] 标签: 显示标签列表（逗号分隔）

**实际结果**: _____________

---

## ✅ 测试 3: 多选作者功能

### 目标
验证多选界面的交互和功能正确性

### 前置条件
- 至少关注 3 位作者
- Python 爬虫已启用（`use_python_scraper: true`）

### 测试步骤

#### TC3.1: 多选界面显示
```bash
选择 "🔄 立即更新"
进入多选界面
```

**预期结果**:
- [ ] 问题文字: "请选择要更新的作者（Space 勾选，Enter 确认）:"
- [ ] 显示所有作者，格式: `作者名 (N 篇)`
- [ ] 默认全部勾选 `[✓]`
- [ ] 第一项高亮显示（金黄色）

**实际结果**: _____________

---

#### TC3.2: 方向键导航
```bash
在多选界面:
1. 按 ↓ 键 3 次
2. 按 ↑ 键 2 次
```

**预期结果**:
- [ ] 按 ↓ 键: 指针下移，高亮下一项
- [ ] 按 ↑ 键: 指针上移，高亮上一项
- [ ] 到达底部时，↓ 键无效（或循环到顶部）
- [ ] 到达顶部时，↑ 键无效（或循环到底部）
- [ ] 响应流畅，无延迟

**实际结果**: _____________

---

#### TC3.3: 空格键勾选/取消
```bash
在多选界面:
1. 移动到第一项，按 Space
2. 移动到第二项，按 Space
3. 移动到第一项，再按 Space
```

**预期结果**:
- [ ] 第 1 次按 Space: `[✓]` → `[ ]`（取消勾选）
- [ ] 第 2 次按 Space: `[✓]` → `[ ]`
- [ ] 第 3 次按 Space: `[ ]` → `[✓]`（重新勾选）
- [ ] 勾选状态立即更新
- [ ] 橙黄色 `✓` 显示正确

**实际结果**: _____________

---

#### TC3.4: 全选和全不选
```bash
在多选界面:
1. 使用 Space 取消所有作者的勾选
2. 尝试按 Enter 确认
```

**预期结果**:
- [ ] 显示验证错误: "至少选择一位作者"
- [ ] 不退出多选界面
- [ ] 光标保持在当前位置

**清理**: 重新勾选至少 1 位作者

**实际结果**: _____________

---

#### TC3.5: Enter 确认选择
```bash
在多选界面:
1. 勾选 2 位作者
2. 按 Enter
```

**预期结果**:
- [ ] 退出多选界面
- [ ] 显示: "已选择 2 位作者"（绿色）
- [ ] 进入下一步（页数设置）

**实际结果**: _____________

---

#### TC3.6: Ctrl+C 取消操作
```bash
在多选界面:
按 Ctrl+C
```

**预期结果**:
- [ ] 退出多选界面
- [ ] 返回主菜单
- [ ] 不执行更新操作

**实际结果**: _____________

---

## 📄 测试 4: 页数设置功能

### 目标
验证页数设置界面和参数传递的正确性

### 前置条件
- 已完成作者选择
- Python 爬虫已启用

### 测试步骤

#### TC4.1: 页数选择界面显示
```bash
选择 "🔄 立即更新"
选择作者（至少 1 位）
进入页数设置界面
```

**预期结果**:
- [ ] 问题文字: "选择下载页数:"
- [ ] 显示 6 个选项:
  - 📄 仅第 1 页（约 50 篇，推荐测试）
  - 📄 前 3 页（约 150 篇）
  - 📄 前 5 页（约 250 篇）
  - 📄 前 10 页（约 500 篇）
  - 📚 全部页面（可能很多）
  - ⚙️  自定义页数
- [ ] 默认选中: "仅第 1 页"

**实际结果**: _____________

---

#### TC4.2: 选择预设页数 - 第 1 页
```bash
选择 "📄 仅第 1 页（约 50 篇，推荐测试）"
按 Enter
```

**预期结果**:
- [ ] 退出页数界面
- [ ] 显示确认信息: "将为 N 位作者更新 前 1 页"
- [ ] 开始更新
- [ ] 日志显示: "下载范围: 前 1 页"
- [ ] 实际只下载第 1 页内容（约 50 篇）

**实际结果**: _____________

---

#### TC4.3: 选择预设页数 - 前 3 页
```bash
选择 "📄 前 3 页（约 150 篇）"
按 Enter
```

**预期结果**:
- [ ] 显示确认信息: "将为 N 位作者更新 前 3 页"
- [ ] 日志显示: "下载范围: 前 3 页"
- [ ] 实际下载前 3 页内容

**实际结果**: _____________

---

#### TC4.4: 选择全部页面
```bash
选择 "📚 全部页面（可能很多）"
按 Enter
```

**预期结果**:
- [ ] 显示确认信息: "将为 N 位作者更新 全部页面"
- [ ] 日志显示: "下载范围: 全部页面"
- [ ] 实际下载所有页面（直到无下一页）

**警告**: 此测试可能耗时较长，建议使用测试作者

**实际结果**: _____________

---

#### TC4.5: 自定义页数 - 输入数字
```bash
选择 "⚙️  自定义页数"
输入: 7
按 Enter
```

**预期结果**:
- [ ] 进入文本输入界面
- [ ] 提示: "请输入页数（留空表示全部）:"
- [ ] 输入 7 后按 Enter
- [ ] 显示确认信息: "将为 N 位作者更新 前 7 页"
- [ ] 实际下载前 7 页

**实际结果**: _____________

---

#### TC4.6: 自定义页数 - 留空
```bash
选择 "⚙️  自定义页数"
直接按 Enter（不输入）
```

**预期结果**:
- [ ] 视为"全部页面"
- [ ] 显示确认信息: "将为 N 位作者更新 全部页面"
- [ ] 实际下载所有页面

**实际结果**: _____________

---

#### TC4.7: 自定义页数 - 输入非法值
```bash
选择 "⚙️  自定义页数"
测试以下输入:
1. 输入 "abc"
2. 输入 "-5"
3. 输入 "0"
```

**预期结果**:
- [ ] 输入 "abc": 显示验证错误
- [ ] 输入 "-5": 显示验证错误
- [ ] 输入 "0": 显示验证错误
- [ ] 不退出输入界面，允许重新输入

**实际结果**: _____________

---

## 🔄 测试 5: 完整更新流程

### 目标
验证从开始到结束的完整更新流程

### 前置条件
- 至少关注 2 位作者
- Python 爬虫已启用
- 网络连接正常

### 测试步骤

#### TC5.1: 标准更新流程（选择部分作者，设置页数）
```bash
1. python main.py
2. 选择 "🔄 立即更新"
3. 查看作者表格
4. 选择 2 位作者（取消 1 位）
5. 选择 "📄 仅第 1 页"
6. 观察更新过程
```

**预期结果**:
- [ ] 步骤 1: 主菜单正常显示
- [ ] 步骤 2: 显示"选择要更新的作者"
- [ ] 步骤 3: 作者表格显示完整
- [ ] 步骤 4: 多选界面正常，选择成功
- [ ] 步骤 5: 页数设置成功
- [ ] 步骤 6:
  - 显示: "🐍 使用 Python 爬虫更新..."
  - 只更新选中的 2 位作者
  - 每位作者只下载第 1 页
  - 显示进度: "(1/2) 更新作者: XXX"
  - 显示: "下载范围: 前 1 页"
  - 显示结果: "✓ 完成: 新增 X 篇, 跳过 X 篇, 失败 X 篇"
  - 所有作者完成后: "✓ 所有作者更新完成"

**实际结果**: _____________

---

#### TC5.2: 全选全部作者，全部页面
```bash
1. 选择 "🔄 立即更新"
2. 保持全选（默认）
3. 选择 "📚 全部页面"
4. 确认更新
```

**预期结果**:
- [ ] 更新所有作者
- [ ] 每个作者下载全部页面
- [ ] 显示确认信息: "将为 N 位作者更新 全部页面"

**警告**: 耗时较长，建议使用少量作者测试

**实际结果**: _____________

---

#### TC5.3: 更新单个作者
```bash
1. 选择 "🔄 立即更新"
2. 只勾选 1 位作者
3. 选择 "📄 仅第 1 页"
```

**预期结果**:
- [ ] 显示: "已选择 1 位作者"
- [ ] 显示: "将为 1 位作者更新 前 1 页"
- [ ] 只更新该作者
- [ ] 进度显示: "(1/1) 更新作者: XXX"

**实际结果**: _____________

---

## 🔄 测试 6: 边界条件和错误处理

### 目标
验证各种边界条件和错误场景的处理

### 测试步骤

#### TC6.1: 无作者时更新
```bash
# 备份配置
编辑 config.yaml，清空 followed_authors
选择 "🔄 立即更新"
```

**预期结果**:
- [ ] 显示警告: "暂无关注的作者，无需更新"
- [ ] 不显示作者表格
- [ ] 不进入多选界面
- [ ] 提示按任意键返回

**清理**: 恢复配置

**实际结果**: _____________

---

#### TC6.2: 作者 URL 缺失
```bash
# 编辑 config.yaml，移除某个作者的 url 字段
选择 "🔄 立即更新"
选择该作者
继续更新流程
```

**预期结果**:
- [ ] 显示警告: "⚠ 跳过作者 XXX（无 URL）"
- [ ] 继续处理其他作者
- [ ] 不崩溃

**清理**: 恢复配置

**实际结果**: _____________

---

#### TC6.3: 网络错误
```bash
# 断开网络
选择 "🔄 立即更新"
选择作者和页数
开始更新
```

**预期结果**:
- [ ] 显示错误: "✗ 失败: [错误信息]"
- [ ] 尝试下一个作者
- [ ] 最后显示失败统计
- [ ] 不崩溃

**清理**: 恢复网络

**实际结果**: _____________

---

#### TC6.4: 中断更新（Ctrl+C）
```bash
选择 "🔄 立即更新"
选择多个作者
开始更新
在更新过程中按 Ctrl+C
```

**预期结果**:
- [ ] 程序正常中断
- [ ] 已下载的内容保留
- [ ] 返回主菜单或退出程序

**实际结果**: _____________

---

#### TC6.5: 超大页数输入
```bash
选择 "⚙️  自定义页数"
输入: 999999
```

**预期结果**:
- [ ] 接受输入（通过验证）
- [ ] 开始更新
- [ ] 实际下载到作者的最后一页（因为没有 999999 页）

**实际结果**: _____________

---

#### TC6.6: 作者信息不完整
```bash
# 编辑 config.yaml，移除某个作者的 total_posts 字段
选择 "🔄 立即更新"
```

**预期结果**:
- [ ] 作者表格正常显示，帖子数显示为 0
- [ ] 多选界面显示 "作者名 (0 篇)"
- [ ] 更新流程正常进行

**实际结果**: _____________

---

## 🔀 测试 7: 兼容性测试

### 目标
验证与 Node.js 桥接的兼容性

### 前置条件
- Node.js 环境正常
- config.yaml 中 `use_python_scraper` 可切换

### 测试步骤

#### TC7.1: Python 爬虫启用
```bash
# config.yaml: use_python_scraper: true
选择 "🔄 立即更新"
```

**预期结果**:
- [ ] 显示作者表格 ✅
- [ ] 多选界面正常 ✅
- [ ] 页数设置正常 ✅
- [ ] 使用 Python 爬虫更新
- [ ] 显示: "🐍 使用 Python 爬虫更新..."

**实际结果**: _____________

---

#### TC7.2: Python 爬虫禁用（Node.js 桥接）
```bash
# config.yaml: use_python_scraper: false
选择 "🔄 立即更新"
```

**预期结果**:
- [ ] **不显示**作者表格（旧流程）
- [ ] **不显示**多选界面（旧流程）
- [ ] **不显示**页数设置（旧流程）
- [ ] 显示确认对话框: "确认为 N 位作者执行更新？"
- [ ] 使用 Node.js 更新所有作者

**或者（如果实现了降级提示）**:
- [ ] 显示警告: "⚠ Node.js 爬虫不支持选择性更新和页数设置"
- [ ] 继续使用 Node.js 更新

**实际结果**: _____________

---

#### TC7.3: Python 爬虫失败，回退 Node.js
```bash
# 模拟 Python 爬虫错误（例如删除 archiver.py）
# config.yaml: use_python_scraper: true
选择 "🔄 立即更新"
```

**预期结果**:
- [ ] 显示错误: "✗ Python 爬虫失败: [错误信息]"
- [ ] 显示: "⚠ 回退到 Node.js 爬虫..."
- [ ] 自动使用 Node.js 继续更新
- [ ] 不崩溃

**清理**: 恢复文件

**实际结果**: _____________

---

#### TC7.4: 配置同步
```bash
# Python 爬虫更新后
检查 config.yaml
```

**预期结果**:
- [ ] `last_update` 字段已更新
- [ ] `total_posts` 字段已更新（累加新增帖子）
- [ ] 配置文件格式正确（YAML）

**实际结果**: _____________

---

## 🔄 测试 8: 回归测试

### 目标
验证 Phase 2-B 没有破坏 Phase 2 的原有功能

### 测试步骤

#### TC8.1: 关注新作者
```bash
选择 "🔍 关注新作者"
输入帖子 URL
```

**预期结果**:
- [ ] 功能正常，与 Phase 2 一致
- [ ] 作者成功添加到配置

**实际结果**: _____________

---

#### TC8.2: 查看关注列表
```bash
选择 "📋 查看关注列表"
```

**预期结果**:
- [ ] 显示作者表格
- [ ] 如果增强了 `show_author_table()`，显示"上次更新"列
- [ ] 表格格式正确

**实际结果**: _____________

---

#### TC8.3: 取消关注作者
```bash
选择 "❌ 取消关注"
选择一位作者
确认取消
```

**预期结果**:
- [ ] 功能正常
- [ ] 作者从配置中移除

**清理**: 重新添加作者（如需要）

**实际结果**: _____________

---

#### TC8.4: 系统设置
```bash
选择 "⚙️  系统设置"
测试各个子菜单
```

**预期结果**:
- [ ] 所有设置菜单正常
- [ ] 颜色主题为金黄色（新）

**实际结果**: _____________

---

#### TC8.5: 单元测试和集成测试
```bash
cd python
pytest tests/ -v
```

**预期结果**:
- [ ] 所有原有测试通过（23/23）
- [ ] 如有新增测试，也应通过

**实际结果**: _____________

---

#### TC8.6: 日志记录
```bash
# 执行更新操作
检查日志文件: logs/archiver.log, logs/extractor.log
```

**预期结果**:
- [ ] 日志正常记录
- [ ] 包含页数信息（新）
- [ ] 包含选中作者信息（新）

**实际结果**: _____________

---

## 📊 测试汇总

### 测试用例统计

| 测试类别 | 用例数 | 通过 | 失败 | 跳过 | 通过率 |
|---------|-------|------|------|------|--------|
| TC1: 颜色主题 | 4 | ___ | ___ | ___ | ___% |
| TC2: 显示作者列表 | 3 | ___ | ___ | ___ | ___% |
| TC3: 多选作者 | 6 | ___ | ___ | ___ | ___% |
| TC4: 页数设置 | 7 | ___ | ___ | ___ | ___% |
| TC5: 完整流程 | 3 | ___ | ___ | ___ | ___% |
| TC6: 边界条件 | 6 | ___ | ___ | ___ | ___% |
| TC7: 兼容性 | 4 | ___ | ___ | ___ | ___% |
| TC8: 回归测试 | 6 | ___ | ___ | ___ | ___% |
| **总计** | **40** | **___** | **___** | **___** | **___%** |

### 测试优先级分布

| 优先级 | 用例数 | 说明 |
|--------|-------|------|
| P0（核心功能） | 22 | 必须通过 |
| P1（用户体验） | 12 | 强烈建议通过 |
| P2（边缘场景） | 6 | 可接受部分失败 |

---

## ✅ 验收标准

### 必须通过（P0）
- [ ] 所有 TC3（多选作者）测试通过
- [ ] 所有 TC4（页数设置）测试通过
- [ ] TC5.1（标准更新流程）通过
- [ ] TC6（边界条件）至少 80% 通过

### 强烈建议通过（P1）
- [ ] 所有 TC1（颜色主题）测试通过
- [ ] TC2（显示作者列表）测试通过
- [ ] TC7（兼容性）测试通过

### 可接受部分失败（P2）
- [ ] TC8（回归测试）至少 80% 通过

---

## 🐛 问题记录模板

### 发现的问题

#### Bug #1
**标题**: _____________
**严重程度**: 🔴 严重 / 🟡 重要 / 🟢 次要
**测试用例**: TC___
**复现步骤**:
1.
2.
3.

**预期行为**: _____________
**实际行为**: _____________
**错误信息**: _____________
**截图**: _____________
**状态**: 🔴 未修复 / 🟡 修复中 / ✅ 已修复

---

## 📝 测试报告模板

### Phase 2-B 测试报告

**测试日期**: _____________
**测试人员**: _____________
**测试环境**:
- OS: _____________
- Python: _____________
- questionary: _____________
- rich: _____________

**测试摘要**:
- 总用例数: 40
- 通过: ___
- 失败: ___
- 跳过: ___
- 通过率: ___%

**关键发现**:
1.
2.
3.

**遗留问题**:
- Bug #1: _____________
- Bug #2: _____________

**建议**:
1.
2.
3.

**验收结论**: ✅ 通过 / ⚠️ 条件通过 / ❌ 不通过

**签字**: _____________
**日期**: _____________

---

## 🔧 测试工具和脚本

### 快速测试脚本（可选）

创建 `python/tests/test_phase2b.py`:

```python
"""Phase 2-B 功能测试"""
import pytest
from pathlib import Path
from src.menu.main_menu import MainMenu
from questionary import Style

def test_custom_style_colors():
    """测试颜色主题"""
    assert MainMenu.custom_style is not None

    # 检查关键颜色
    styles = dict(MainMenu.custom_style.style_rules)

    # 指针和高亮应该是金黄色
    assert 'FFD700' in styles.get('pointer', '')
    assert 'FFD700' in styles.get('highlighted', '')

    # 问号应该是金黄色
    assert 'FFD700' in styles.get('qmark', '')

def test_author_table_display():
    """测试作者表格显示（单元测试）"""
    from src.utils.display import show_author_table

    test_authors = [
        {
            'name': '测试作者1',
            'added_date': '2026-02-11',
            'last_update': '2026-02-11 22:30:01',
            'total_posts': 78,
            'tags': ['test']
        },
        {
            'name': '测试作者2',
            'added_date': '2026-02-11',
            'last_update': None,
            'total_posts': 0,
            'tags': []
        }
    ]

    # 不应该抛出异常
    show_author_table(test_authors)

# 更多测试...
```

运行:
```bash
cd python
pytest tests/test_phase2b.py -v
```

---

## 📚 参考资料

### Questionary 文档
- https://questionary.readthedocs.io/
- Checkbox: https://questionary.readthedocs.io/en/stable/pages/types.html#checkbox
- Style: https://questionary.readthedocs.io/en/stable/pages/advanced.html#styling

### Rich 文档
- https://rich.readthedocs.io/
- Tables: https://rich.readthedocs.io/en/stable/tables.html

### 颜色参考
- Material Design Colors: https://material.io/design/color/
- 终端颜色测试: https://gist.github.com/XVilka/8346728

---

**测试文档版本**: v1.0
**创建日期**: 2026-02-11
**状态**: 📋 待测试

---

**测试完成后请填写测试报告并提交！** ✅
