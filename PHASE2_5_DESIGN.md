# Phase 2.5: HTML æ¨¡æ¿ç»Ÿä¸€ä¼˜åŒ–

> **ç‰ˆæœ¬**: v2.5
> **çŠ¶æ€**: ğŸ”´ å¾…å¼€å§‹
> **åˆ›å»ºæ—¥æœŸ**: 2026-02-12
> **é¢„è®¡å·¥æœŸ**: 1 å°æ—¶
> **ä¼˜å…ˆçº§**: P1ï¼ˆç”¨æˆ·ä½“éªŒæå‡ + ç®€åŒ– Phase 3ï¼‰

---

## ğŸ“‹ ç›®å½•

- [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
- [äºŒã€é—®é¢˜åˆ†æ](#äºŒé—®é¢˜åˆ†æ)
- [ä¸‰ã€è§£å†³æ–¹æ¡ˆ](#ä¸‰è§£å†³æ–¹æ¡ˆ)
- [å››ã€è¯¦ç»†å®æ–½æ­¥éª¤](#å››è¯¦ç»†å®æ–½æ­¥éª¤)
- [äº”ã€éªŒæ”¶æ ‡å‡†](#äº”éªŒæ”¶æ ‡å‡†)
- [å…­ã€æµ‹è¯•æ¸…å•](#å…­æµ‹è¯•æ¸…å•)
- [ä¸ƒã€å¯¹åç»­ Phase çš„å½±å“](#ä¸ƒå¯¹åç»­-phase-çš„å½±å“)
- [å…«ã€å›æ»šæ–¹æ¡ˆ](#å…«å›æ»šæ–¹æ¡ˆ)

---

## ä¸€ã€æ¦‚è¿°

### 1.1 ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡**ï¼šç»Ÿä¸€æ‰€æœ‰å½’æ¡£å¸–å­çš„ `content.html` æ ¼å¼ï¼Œä¼˜åŒ–ç»ˆç«¯æµè§ˆä½“éªŒ

**å…·ä½“ç›®æ ‡**ï¼š
1. âœ… ç»Ÿä¸€ HTML æ¨¡æ¿ï¼ˆå•ä¸€æ ‡å‡†æ ¼å¼ï¼‰
2. âœ… ä¼˜åŒ– w3m ç»ˆç«¯æµè§ˆå™¨æ”¯æŒ
3. âœ… å…ƒæ•°æ®å¯è§åŒ–ï¼ˆä»æ³¨é‡Šç§»åˆ°é¡µé¢ï¼‰
4. âœ… åª’ä½“æ–‡ä»¶æ¸…å•åŒ–ï¼ˆå›¾ç‰‡/è§†é¢‘åˆ—è¡¨ï¼‰
5. âœ… ç®€åŒ– Phase 3 æ•°æ®åº“å¯¼å…¥

### 1.2 èƒŒæ™¯

**å½“å‰çŠ¶æ€**ï¼ˆPhase 2 å®Œæˆåï¼‰ï¼š
- âœ… Python çˆ¬è™«å·²å®ç°å¹¶å¯ç”¨ï¼ˆ`use_python_scraper: true`ï¼‰
- âœ… å·²å½’æ¡£ 278 ç¯‡æµ‹è¯•å¸–å­ï¼ˆ7 ä½ä½œè€…ï¼‰
- âŒ content.html æ ¼å¼ä¸ç»Ÿä¸€ï¼ˆçº¯æ–‡æœ¬/å›¾ç‰‡/è§†é¢‘å„ä¸ç›¸åŒï¼‰
- âŒ w3m æµè§ˆä½“éªŒå·®ï¼ˆç¼ºå°‘ç»“æ„ã€å…ƒæ•°æ®éšè—ï¼‰

**ç®€åŒ–å‰æ**ï¼š
- ğŸ—‘ï¸ æµ‹è¯•æ•°æ®å¯åˆ é™¤ï¼ˆæ— éœ€å‘åå…¼å®¹ï¼‰
- âœ… ä»é›¶å¼€å§‹é‡‡ç”¨æœ€ä¼˜æ–¹æ¡ˆ
- âœ… æ— å†å²åŒ…è¢±ï¼Œæ— æŠ€æœ¯å€º

### 1.3 æ”¶ç›Š

**ç”¨æˆ·ä½“éªŒ**ï¼š
- âœ… w3m ç»ˆç«¯æµè§ˆä½“éªŒä¼˜åŒ–ï¼ˆæ¸…æ™°ç»“æ„ã€æ˜“äºå¯¼èˆªï¼‰
- âœ… å…ƒæ•°æ®å¯è§ï¼ˆæ ‡é¢˜ã€ä½œè€…ã€æ—¶é—´ã€URLï¼‰
- âœ… æœ¬åœ°æ–‡ä»¶æ¸…å•ï¼ˆphoto/img_1.jpg, video/video_1.mp4ï¼‰

**å¼€å‘æ•ˆç‡**ï¼š
- âœ… Phase 3 å¼€å‘æ—¶é—´èŠ‚çœ **2 å°æ—¶**ï¼ˆæ— éœ€è§£æå¤šç§æ ¼å¼ï¼‰
- âœ… å†å²æ•°æ®å¯¼å…¥å·¥å…·ä¸éœ€è¦ï¼ˆæµ‹è¯•æ•°æ®å·²åˆ é™¤ï¼‰
- âœ… æµ‹è¯•éªŒè¯ç®€åŒ–ï¼ˆå•ä¸€æ ¼å¼ï¼Œæ— æ··åˆï¼‰

**ä»£ç è´¨é‡**ï¼š
- âœ… æ ¼å¼ç»Ÿä¸€ï¼Œæ˜“äºç»´æŠ¤
- âœ… é›¶æŠ€æœ¯å€ºï¼Œæ— å…¼å®¹é€»è¾‘
- âœ… æ¨¡æ¿åŒ–è®¾è®¡ï¼Œæ‰©å±•æ–¹ä¾¿

---

## äºŒã€é—®é¢˜åˆ†æ

### 2.1 å½“å‰ content.html æ ¼å¼é—®é¢˜

#### é—®é¢˜ 1: æ ¼å¼ä¸¥é‡ä¸ç»Ÿä¸€

**çº¯æ–‡æœ¬å¸–å­**ï¼š
```html
<!-- å¸–å­å…ƒæ•°æ®
æ ‡é¢˜: æ­ç§˜æ²³å—åœ°äº§ç‹çš„èµ·ä¼äººç”Ÿ
ä½œè€…: ç‹¬é†‰ç¬‘æ¸…é£
æ—¶é—´: 2022-08-29 06:53
URL: https://t66y.com/htm_data/2208/7/5254402.html
-->

è°¨æ…åŠç”Ÿ...<br><br><br><br>"æˆ‘å·²ç»å¿«70å²äº†..."<br><br><br>01.<br>ä¸­åŸç¬¬ä¸€æª<br><br>...
```

**å›¾ç‰‡å¸–å­**ï¼š
```html
<!-- å¸–å­å…ƒæ•°æ®... -->

äº”ç‚¹åŠçš„æ—©æ™¨ï¼Œ<br>å‘¨å›´ä¹Œæ¼†å˜›é»‘ï¼Œ<br>...<br>
<div class="image-big">
  <img iyl-data="..." ess-data="..." src="..." style="...">
  <div class="image-big-text">é“¾æ¥</div>
</div><br>
<div class="image-big">...</div><br>
...
```

**è§†é¢‘å¸–å­**ï¼š
```html
<!-- å¸–å­å…ƒæ•°æ®... -->

<video src="https://..." controls="controls" style="..." loop="true">
  æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚
</video><br>
<video src="..."></video><br>
...
```

**é—®é¢˜æ€»ç»“**ï¼š
- âŒ ä¸‰ç§å®Œå…¨ä¸åŒçš„ HTML ç»“æ„
- âŒ æ²¡æœ‰ç»Ÿä¸€çš„é¡µé¢æ¡†æ¶
- âŒ å†…è”æ ·å¼æ··ä¹±ï¼ˆ`style="..."` åˆ°å¤„éƒ½æ˜¯ï¼‰

#### é—®é¢˜ 2: å…³é”®ä¿¡æ¯éšè—æˆ–ç¼ºå¤±

- âŒ **å…ƒæ•°æ®åœ¨æ³¨é‡Šä¸­**ï¼šç”¨æˆ·åœ¨æµè§ˆå™¨/w3m ä¸­çœ‹ä¸åˆ°æ ‡é¢˜ã€ä½œè€…ã€æ—¶é—´
- âŒ **æ²¡æœ‰æœ¬åœ°æ–‡ä»¶æ¸…å•**ï¼šä¸çŸ¥é“ `photo/` ç›®å½•ä¸‹æœ‰å“ªäº›å›¾ç‰‡
- âŒ **æ²¡æœ‰å½’æ¡£ç»Ÿè®¡**ï¼šä¸çŸ¥é“æœ¬å¸–å…±å¤šå°‘å¼ å›¾ç‰‡ã€å¤šå°‘ä¸ªè§†é¢‘
- âŒ **æ²¡æœ‰å½’æ¡£æ—¶é—´**ï¼šä¸çŸ¥é“ä½•æ—¶æŠ“å–çš„

#### é—®é¢˜ 3: w3m æµè§ˆå™¨å…¼å®¹æ€§å·®

- âŒ **ç¼ºå°‘å®Œæ•´ HTML ç»“æ„**ï¼šæ—  `<!DOCTYPE>`, `<head>`, `<body>`
- âŒ **å¤æ‚çš„ div åµŒå¥—**ï¼š`<div class="image-big">` w3m æ¸²æŸ“æ··ä¹±
- âŒ **ç¼ºå°‘è¯­ä¹‰åŒ–æ ‡ç­¾**ï¼šæ²¡æœ‰ `<article>`, `<header>`, `<section>`
- âŒ **å›¾ç‰‡/è§†é¢‘æ— æœ¬åœ°é“¾æ¥**ï¼šåªèƒ½åœ¨çº¿æŸ¥çœ‹ï¼Œä¸èƒ½ç‚¹å‡»æœ¬åœ°æ–‡ä»¶

#### é—®é¢˜ 4: æ’ç‰ˆä¸ç¾è§‚

- âŒ **è¿ç»­å¤šä¸ª `<br>`**ï¼š`<br><br><br><br>` ç©ºç™½è¿‡å¤š
- âŒ **æ²¡æœ‰æ®µè½ç»“æ„**ï¼šåº”è¯¥ç”¨ `<p>` è€Œé `<br>`
- âŒ **æ ‡é¢˜ä¸çªå‡º**ï¼šç« èŠ‚æ ‡é¢˜ï¼ˆå¦‚ "01. ä¸­åŸç¬¬ä¸€æª"ï¼‰æ˜¯æ™®é€šæ–‡æœ¬
- âŒ **åª’ä½“èµ„æºæ— ç»„ç»‡**ï¼šå›¾ç‰‡/è§†é¢‘æ··åœ¨æ­£æ–‡ä¸­

### 2.2 w3m æµè§ˆæ•ˆæœå¯¹æ¯”

#### å½“å‰æ•ˆæœï¼ˆé—®é¢˜ï¼‰
```
è°¨æ…åŠç”Ÿ...(å¤§æ®µæ–‡æœ¬æ— ç»“æ„)

01.(æ ‡é¢˜ä¸çªå‡º)
ä¸­åŸç¬¬ä¸€æª(æ²¡æœ‰åˆ†éš”)

(è¿ç»­ç©ºè¡Œ)(è¿ç»­ç©ºè¡Œ)(è¿ç»­ç©ºè¡Œ)

èƒ¡è‘†æ£®ææˆ¿åœ°äº§...(æ®µè½ä¸æ¸…æ™°)

[image-big](divæ ‡ç­¾æ˜¾ç¤ºä¸ºæ–‡æœ¬)
[é“¾æ¥](æ— æ³•ç‚¹å‡»)
```

#### æœŸæœ›æ•ˆæœï¼ˆä¼˜åŒ–åï¼‰
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ­ç§˜æ²³å—åœ°äº§ç‹çš„èµ·ä¼äººç”Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ä½œè€…: ç‹¬é†‰ç¬‘æ¸…é£ | å‘å¸ƒ: 2022-08-29 06:53 | å½’æ¡£: 2026-02-12

  è°¨æ…åŠç”Ÿï¼Œååœ°ç§°ç‹çš„æ²³å—åœ°äº§ä¸€å“¥ã€å»ºä¸šè‘£äº‹é•¿èƒ¡è‘†æ£®ï¼Œ
30å¹´æ¥èº²è¿‡æ•°æ³¢å¤§é£å¤§æµª...

01. ä¸­åŸç¬¬ä¸€æª
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  èƒ¡è‘†æ£®ææˆ¿åœ°äº§çš„æƒ³æ³•ï¼Œæ˜¯åœ¨1992å¹´æ˜¥å¤©è¿¸å‘çš„...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“· å›¾ç‰‡ (22)
[1] photo/img_1.jpg (å¯ç‚¹å‡»)
[2] photo/img_2.jpg (å¯ç‚¹å‡»)
...
```

---

## ä¸‰ã€è§£å†³æ–¹æ¡ˆ

### 3.1 æŠ€æœ¯é€‰å‹

#### æ¨¡æ¿å¼•æ“ï¼šJinja2

**é€‰æ‹©ç†ç”±**ï¼š
- âœ… Python ç”Ÿæ€æ ‡å‡†ï¼ˆFlask, Django éƒ½ä½¿ç”¨ï¼‰
- âœ… è¯­æ³•ç®€æ´ï¼ˆ`{{ var }}`, `{% if %}`, `{% for %}`ï¼‰
- âœ… åŠŸèƒ½å¼ºå¤§ï¼ˆè¿‡æ»¤å™¨ã€ç»§æ‰¿ã€å®ï¼‰
- âœ… å·²åœ¨ requirements.txt ä¸­ï¼ˆæ— éœ€é¢å¤–å®‰è£…ï¼‰

**æ›¿ä»£æ–¹æ¡ˆå¯¹æ¯”**ï¼š
| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | ç»“è®º |
|------|------|------|------|
| **Jinja2** | æ ‡å‡†ã€å¼ºå¤§ã€æ˜“ç”¨ | - | âœ… é‡‡ç”¨ |
| f-string | ç®€å•ã€æ— ä¾èµ– | å¤æ‚æ¨¡æ¿éš¾ç»´æŠ¤ | âŒ ä¸é€‚åˆ |
| string.Template | æ— ä¾èµ– | åŠŸèƒ½å¤ªå¼± | âŒ ä¸é€‚åˆ |
| æ‰‹å†™æ‹¼æ¥ | çµæ´» | ä»£ç æ··ä¹± | âŒ ä¸é€‚åˆ |

#### HTML è®¾è®¡åŸåˆ™

1. **è¯­ä¹‰åŒ–æ ‡ç­¾ä¼˜å…ˆ**ï¼š`<article>`, `<header>`, `<section>`, `<footer>`
2. **w3m å‹å¥½ CSS**ï¼šåªä½¿ç”¨ w3m æ”¯æŒçš„åŸºç¡€æ ·å¼
3. **çº¯æ–‡æœ¬å¯è¯»**ï¼šå³ä½¿æ²¡æœ‰ CSS ä¹Ÿç»“æ„æ¸…æ™°
4. **å•æ–‡ä»¶å®Œæ•´**ï¼šæ— å¤–éƒ¨ CSS/JS ä¾èµ–

### 3.2 æ¶æ„è®¾è®¡

#### æ–‡ä»¶ç»“æ„

```
python/src/templates/
  â”œâ”€â”€ __init__.py                 # ç©ºæ–‡ä»¶
  â”œâ”€â”€ post.html                   # ä¸»æ¨¡æ¿ï¼ˆ80 è¡Œï¼‰
  â””â”€â”€ filters.py                  # å†…å®¹æ¸…ç†è¿‡æ»¤å™¨ï¼ˆ60 è¡Œï¼‰

python/src/scraper/
  â””â”€â”€ archiver.py                 # ä¿®æ”¹ä¿å­˜é€»è¾‘ï¼ˆ30 è¡Œæ”¹åŠ¨ï¼‰
```

#### æ•°æ®æµ

```
å¸–å­åŸå§‹æ•°æ® (dict)
    â†“
å†…å®¹æ¸…ç† (filters.clean_html_content)
    â†“
æ¨¡æ¿æ¸²æŸ“ (Jinja2)
    â†“
ç”Ÿæˆ HTML (post.html)
    â†“
ä¿å­˜æ–‡ä»¶ (content.html)
```

#### æ¨¡æ¿å˜é‡

```python
template_data = {
    # å…ƒæ•°æ®
    'title': str,              # å¸–å­æ ‡é¢˜
    'author': str,             # ä½œè€…å
    'publish_time': str,       # å‘å¸ƒæ—¶é—´ (YYYY-MM-DD HH:MM)
    'archive_time': str,       # å½’æ¡£æ—¶é—´ (YYYY-MM-DD HH:MM:SS)
    'url': str,                # åŸå§‹ URL

    # æ­£æ–‡
    'content': str,            # HTML å†…å®¹ï¼ˆä¼šé€šè¿‡ filter æ¸…ç†ï¼‰
    'content_length': int,     # å­—ç¬¦æ•°

    # åª’ä½“
    'images': List[dict],      # [{'filename': 'img_1.jpg', 'url': '...'}, ...]
    'videos': List[dict],      # [{'filename': 'video_1.mp4', 'url': '...'}, ...]
}
```

---

## å››ã€è¯¦ç»†å®æ–½æ­¥éª¤

### Step 1: åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ï¼ˆ15 åˆ†é’Ÿï¼‰

#### 1.1 åˆ›å»ºç›®å½•ç»“æ„

```bash
mkdir -p python/src/templates
touch python/src/templates/__init__.py
```

#### 1.2 åˆ›å»ºä¸»æ¨¡æ¿ `python/src/templates/post.html`

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - {{ author }}</title>
    <style>
        /* æç®€ CSSï¼Œw3m å‹å¥½ */
        body {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
            line-height: 1.6;
            font-family: monospace;
        }
        h1 {
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .meta {
            color: #666;
            margin: 5px 0;
            font-size: 0.95em;
        }
        .meta b {
            color: #000;
        }
        article {
            margin: 30px 0;
        }
        article p {
            margin: 10px 0;
            text-indent: 2em;
        }
        article h2 {
            font-size: 1.3em;
            margin: 25px 0 15px 0;
            border-bottom: 1px solid #999;
            padding-bottom: 5px;
        }
        section {
            margin: 30px 0;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        section h2 {
            font-size: 1.2em;
            border-bottom: none;
        }
        .file {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #ccc;
            padding-left: 10px;
        }
        .file a {
            color: #06c;
            text-decoration: none;
        }
        .file a:hover {
            text-decoration: underline;
        }
        footer {
            border-top: 1px solid #ccc;
            margin-top: 30px;
            padding-top: 10px;
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

<!-- å¤´éƒ¨ï¼šå…ƒæ•°æ® -->
<header>
    <h1>{{ title }}</h1>
    <div class="meta">
        <b>ä½œè€…:</b> {{ author }} |
        <b>å‘å¸ƒ:</b> {{ publish_time }} |
        <b>å½’æ¡£:</b> {{ archive_time }}
    </div>
    <div class="meta">
        <b>åŸæ–‡:</b> <a href="{{ url }}">{{ url }}</a>
    </div>
</header>

<!-- æ­£æ–‡ -->
<article>
    {{ content|safe }}
</article>

<!-- å›¾ç‰‡åˆ—è¡¨ -->
{% if images %}
<section>
    <h2>ğŸ“· å›¾ç‰‡ ({{ images|length }})</h2>
    {% for img in images %}
    <div class="file">
        <strong>[{{ loop.index }}]</strong>
        <a href="photo/{{ img.filename }}">photo/{{ img.filename }}</a>
        {% if img.size %}({{ img.size }}){% endif %}
    </div>
    {% endfor %}
</section>
{% endif %}

<!-- è§†é¢‘åˆ—è¡¨ -->
{% if videos %}
<section>
    <h2>ğŸ¬ è§†é¢‘ ({{ videos|length }})</h2>
    {% for vid in videos %}
    <div class="file">
        <strong>[{{ loop.index }}]</strong>
        <a href="video/{{ vid.filename }}">video/{{ vid.filename }}</a>
        {% if vid.size %}({{ vid.size }}){% endif %}
    </div>
    {% endfor %}
</section>
{% endif %}

<!-- é¡µè„šï¼šç»Ÿè®¡ -->
<footer>
    <p>
        <b>ç»Ÿè®¡:</b> {{ content_length }} å­—ç¬¦ |
        {{ images|length }} å›¾ç‰‡ |
        {{ videos|length }} è§†é¢‘
    </p>
    <p>
        <b>å½’æ¡£:</b> {{ archive_time }} |
        <b>ç”Ÿæˆå™¨:</b> Python Scraper v2.5 (Playwright + Jinja2)
    </p>
    <p>
        <b>ç»ˆç«¯æµè§ˆ:</b> <code>w3m content.html</code>
    </p>
</footer>

</body>
</html>
```

**éªŒè¯**ï¼š
```bash
wc -l python/src/templates/post.html
# åº”è¾“å‡ºçº¦ 80 è¡Œ
```

---

### Step 2: åˆ›å»ºè¿‡æ»¤å™¨ï¼ˆ15 åˆ†é’Ÿï¼‰

#### 2.1 åˆ›å»º `python/src/templates/filters.py`

```python
"""HTML å†…å®¹æ¸…ç†å’Œæ ¼å¼åŒ–

åŠŸèƒ½ï¼š
1. ç§»é™¤å¤æ‚çš„ div åµŒå¥—
2. è½¬æ¢è¿ç»­ <br> ä¸ºæ®µè½
3. æå–ç« èŠ‚æ ‡é¢˜
4. ç§»é™¤å›¾ç‰‡/è§†é¢‘æ ‡ç­¾ï¼ˆå•ç‹¬åˆ—è¡¨å±•ç¤ºï¼‰
5. ä¼˜åŒ– w3m æµè§ˆä½“éªŒ
"""
import re


def clean_html_content(raw_html: str) -> str:
    """
    æ¸…ç†åŸå§‹ HTMLï¼Œè½¬æ¢ä¸ºé€‚åˆé˜…è¯»çš„æ ¼å¼

    Args:
        raw_html: ä»ç½‘é¡µæå–çš„åŸå§‹ HTML

    Returns:
        æ¸…ç†åçš„ HTMLï¼ˆæ®µè½ç»“æ„ã€ç« èŠ‚æ ‡é¢˜ï¼‰
    """
    if not raw_html or not raw_html.strip():
        return '<p>ï¼ˆæ— å†…å®¹ï¼‰</p>'

    html = raw_html

    # 1. ç§»é™¤å›¾ç‰‡ divï¼ˆä¼šåœ¨åº•éƒ¨å•ç‹¬åˆ—å‡ºï¼‰
    html = re.sub(
        r'<div\s+class="image-big">.*?</div>',
        '',
        html,
        flags=re.DOTALL | re.IGNORECASE
    )

    # 2. ç§»é™¤è§†é¢‘æ ‡ç­¾ï¼ˆä¼šåœ¨åº•éƒ¨å•ç‹¬åˆ—å‡ºï¼‰
    html = re.sub(
        r'<video.*?</video>',
        '',
        html,
        flags=re.DOTALL | re.IGNORECASE
    )

    # 3. ç§»é™¤ç‚¹èµæŒ‰é’®ç­‰æ— å…³å…ƒç´ 
    html = re.sub(
        r'<div\s+onclick="clickLike.*?</div>',
        '',
        html,
        flags=re.DOTALL | re.IGNORECASE
    )

    # 4. è½¬æ¢è¿ç»­ <br> ä¸ºæ®µè½åˆ†éš”
    html = re.sub(r'(<br\s*/?>){2,}', '</p>\n<p>', html, flags=re.IGNORECASE)

    # 5. ç§»é™¤å‰©ä½™çš„å•ä¸ª <br>ï¼ˆæ®µè½å†…æ¢è¡Œï¼‰
    html = re.sub(r'<br\s*/?>', ' ', html, flags=re.IGNORECASE)

    # 6. è¯†åˆ«ç« èŠ‚æ ‡é¢˜ï¼ˆå¦‚ "01." "ä¸€ã€" å¼€å¤´ï¼‰
    html = re.sub(
        r'<p>\s*(\d+\.|\d+ã€|[ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+ã€)\s*([^<]+?)\s*</p>',
        r'<h2>\1 \2</h2>',
        html
    )

    # 7. åŒ…è£¹æ®µè½ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
    if not html.strip().startswith('<p>') and not html.strip().startswith('<h'):
        html = f'<p>{html}</p>'

    # 8. æ¸…ç†å¤šä½™ç©ºè¡Œ
    html = re.sub(r'\n{3,}', '\n\n', html)

    # 9. æ¸…ç†ç©ºæ®µè½
    html = re.sub(r'<p>\s*</p>', '', html)

    # 10. å»é™¤é¦–å°¾ç©ºç™½
    html = html.strip()

    return html


def format_file_size(size_bytes: int) -> str:
    """
    æ ¼å¼åŒ–æ–‡ä»¶å¤§å°

    Args:
        size_bytes: å­—èŠ‚æ•°

    Returns:
        æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆå¦‚ "1.2 MB"ï¼‰
    """
    if size_bytes < 1024:
        return f"{size_bytes} B"
    elif size_bytes < 1024 * 1024:
        return f"{size_bytes / 1024:.1f} KB"
    elif size_bytes < 1024 * 1024 * 1024:
        return f"{size_bytes / (1024 * 1024):.1f} MB"
    else:
        return f"{size_bytes / (1024 * 1024 * 1024):.1f} GB"
```

**éªŒè¯**ï¼š
```bash
python3 -c "from src.templates.filters import clean_html_content; print('âœ“ å¯¼å…¥æˆåŠŸ')"
```

---

### Step 3: ä¿®æ”¹ Archiverï¼ˆ20 åˆ†é’Ÿï¼‰

#### 3.1 åœ¨ `python/src/scraper/archiver.py` é¡¶éƒ¨æ·»åŠ å¯¼å…¥

```python
# åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ 
from jinja2 import Environment, FileSystemLoader
from pathlib import Path
from datetime import datetime
import sys

# åœ¨å…¶ä»–å¯¼å…¥ä¹‹åæ·»åŠ 
sys.path.insert(0, str(Path(__file__).parent.parent))
from templates.filters import clean_html_content, format_file_size
```

#### 3.2 ä¿®æ”¹ `__init__` æ–¹æ³•

```python
class ForumArchiver:
    def __init__(self, config: dict):
        # ... ç°æœ‰ä»£ç  ...

        # åˆå§‹åŒ–æ¨¡æ¿å¼•æ“
        template_dir = Path(__file__).parent.parent / 'templates'
        self.jinja_env = Environment(loader=FileSystemLoader(str(template_dir)))

        # æ³¨å†Œè‡ªå®šä¹‰è¿‡æ»¤å™¨
        self.jinja_env.filters['clean'] = clean_html_content
        self.jinja_env.filters['size'] = format_file_size

        self.logger.info("æ¨¡æ¿å¼•æ“å·²åˆå§‹åŒ–")
```

#### 3.3 æ·»åŠ æ–°æ–¹æ³•ï¼šå‡†å¤‡åª’ä½“åˆ—è¡¨

åœ¨ `ForumArchiver` ç±»ä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•ï¼š

```python
def _prepare_media_list(self, media_urls: list, media_type: str, post_dir: Path) -> list:
    """
    å‡†å¤‡åª’ä½“æ–‡ä»¶åˆ—è¡¨ï¼ˆç”¨äºæ¨¡æ¿ï¼‰

    Args:
        media_urls: åŸå§‹ URL åˆ—è¡¨
        media_type: 'image' æˆ– 'video'
        post_dir: å¸–å­ç›®å½•

    Returns:
        [{'filename': 'img_1.jpg', 'url': '...', 'size': '1.2 MB'}, ...]
    """
    media_list = []

    # ç¡®å®šå­ç›®å½•å’Œæ–‡ä»¶å‰ç¼€
    if media_type == 'image':
        subdir = post_dir / 'photo'
        prefix = 'img_'
        extensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp']
    else:  # video
        subdir = post_dir / 'video'
        prefix = 'video_'
        extensions = ['.mp4', '.avi', '.mkv', '.webm', '.mov']

    if not subdir.exists():
        return []

    # éå†åŸå§‹ URLï¼ŒåŒ¹é…æœ¬åœ°æ–‡ä»¶
    for idx, url in enumerate(media_urls, 1):
        # å°è¯•æ‰¾åˆ°å¯¹åº”çš„æœ¬åœ°æ–‡ä»¶
        filename = None
        file_size = None

        # æ–¹æ³•1ï¼šæŒ‰ç´¢å¼•åŒ¹é…ï¼ˆimg_1.jpg, img_2.jpg...ï¼‰
        for ext in extensions:
            candidate = subdir / f"{prefix}{idx}{ext}"
            if candidate.exists():
                filename = f"{prefix}{idx}{ext}"
                file_size = candidate.stat().st_size
                break

        # å¦‚æœæ‰¾ä¸åˆ°ï¼Œä½¿ç”¨å ä½
        if not filename:
            filename = f"{prefix}{idx}.unknown"

        media_list.append({
            'filename': filename,
            'url': url,
            'size': format_file_size(file_size) if file_size else None
        })

    return media_list
```

#### 3.4 ä¿®æ”¹ä¿å­˜å†…å®¹çš„æ–¹æ³•

æ‰¾åˆ°åŸæ¥ä¿å­˜ content.html çš„åœ°æ–¹ï¼ˆå¯èƒ½åœ¨ `_archive_post` æˆ–ç±»ä¼¼æ–¹æ³•ä¸­ï¼‰ï¼Œæ›¿æ¢ä¸ºï¼š

```python
def _save_content_html(self, post_data: dict, post_dir: Path):
    """
    ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆå¹¶ä¿å­˜ content.html

    Args:
        post_data: å¸–å­æ•°æ®ï¼ˆåŒ…å« title, author, time, content, images, videos, urlï¼‰
        post_dir: å¸–å­ç›®å½•
    """
    try:
        # å‡†å¤‡æ¨¡æ¿æ•°æ®
        template_data = {
            'title': post_data.get('title', 'æ— æ ‡é¢˜'),
            'author': post_data.get('author', 'æœªçŸ¥ä½œè€…'),
            'publish_time': post_data.get('time', 'N/A'),
            'archive_time': datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
            'url': post_data.get('url', ''),
            'content': clean_html_content(post_data.get('content', '')),
            'content_length': len(post_data.get('content', '')),
            'images': self._prepare_media_list(
                post_data.get('images', []),
                'image',
                post_dir
            ),
            'videos': self._prepare_media_list(
                post_data.get('videos', []),
                'video',
                post_dir
            )
        }

        # åŠ è½½æ¨¡æ¿
        template = self.jinja_env.get_template('post.html')

        # æ¸²æŸ“ HTML
        html = template.render(**template_data)

        # ä¿å­˜æ–‡ä»¶
        content_file = post_dir / 'content.html'
        content_file.write_text(html, encoding='utf-8')

        self.logger.info(f"å·²ç”Ÿæˆ content.html: {template_data['title']}")

    except Exception as e:
        self.logger.error(f"ç”Ÿæˆ content.html å¤±è´¥: {str(e)}", exc_info=True)
        raise
```

#### 3.5 åœ¨å½’æ¡£æµç¨‹ä¸­è°ƒç”¨

ç¡®ä¿åœ¨å½’æ¡£æµç¨‹ä¸­è°ƒç”¨ `_save_content_html`ï¼š

```python
# åœ¨ archive_author æˆ–ç±»ä¼¼æ–¹æ³•ä¸­ï¼Œä¸‹è½½å®Œæˆåï¼š

# ä¸‹è½½å›¾ç‰‡å’Œè§†é¢‘ï¼ˆç°æœ‰é€»è¾‘ï¼‰
# ...

# ä½¿ç”¨æ–°æ¨¡æ¿ç”Ÿæˆ content.html
self._save_content_html(post_data, post_dir)

# æ ‡è®°å®Œæˆ
mark_complete(post_dir, post_url)
```

**éªŒè¯**ï¼š
```bash
python3 -c "from src.scraper.archiver import ForumArchiver; print('âœ“ å¯¼å…¥æˆåŠŸ')"
```

---

### Step 4: æµ‹è¯•ä¸éªŒè¯ï¼ˆ10 åˆ†é’Ÿï¼‰

#### 4.1 å½’æ¡£æµ‹è¯•å¸–å­

```bash
cd python
python main.py

# é€‰æ‹© [3] ç«‹å³æ›´æ–°
# é€‰æ‹© 1-2 ä½ä½œè€…
# è®¾ç½®ä¸‹è½½ 1 é¡µï¼ˆæµ‹è¯•ï¼‰

# ç­‰å¾…å½’æ¡£å®Œæˆ
```

#### 4.2 æ£€æŸ¥ç”Ÿæˆçš„ HTML

```bash
# æŸ¥æ‰¾æœ€æ–°å½’æ¡£çš„å¸–å­
LATEST=$(find /home/ben/Download/t66y -name "content.html" -type f -printf '%T+ %p\n' | sort -r | head -1 | cut -d' ' -f2-)

# æŸ¥çœ‹æ–‡ä»¶
cat "$LATEST"

# é¢„æœŸï¼šçœ‹åˆ°å®Œæ•´çš„ HTML ç»“æ„ï¼ˆ<!DOCTYPE>, <html>, <head>, <body>ï¼‰
# é¢„æœŸï¼šçœ‹åˆ°å…ƒæ•°æ®åœ¨ <header> ä¸­
# é¢„æœŸï¼šçœ‹åˆ°æ­£æ–‡åœ¨ <article> ä¸­
# é¢„æœŸï¼šçœ‹åˆ°å›¾ç‰‡/è§†é¢‘åˆ—è¡¨åœ¨ <section> ä¸­
```

#### 4.3 w3m æµè§ˆæµ‹è¯•

```bash
# ä½¿ç”¨ w3m æµè§ˆ
w3m "$LATEST"

# é¢„æœŸæ•ˆæœï¼š
# - æ ‡é¢˜å¤§è€Œæ¸…æ™°
# - å…ƒæ•°æ®å¯è§ï¼ˆä½œè€…ã€å‘å¸ƒã€å½’æ¡£æ—¶é—´ï¼‰
# - æ­£æ–‡æ®µè½åˆ†æ˜
# - ç« èŠ‚æ ‡é¢˜çªå‡º
# - å›¾ç‰‡/è§†é¢‘åˆ—è¡¨æ¸…æ™°
# - å¯ä»¥ç”¨æ–¹å‘é”®å¯¼èˆª
# - é“¾æ¥å¯ä»¥ç‚¹å‡»ï¼ˆEnter é”®ï¼‰
```

#### 4.4 æµè§ˆå™¨æŸ¥çœ‹æµ‹è¯•

```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
firefox "$LATEST"

# é¢„æœŸæ•ˆæœï¼š
# - æ’ç‰ˆç¾è§‚
# - æ ·å¼æ­£å¸¸
# - é“¾æ¥å¯ç‚¹å‡»
```

---

### Step 5: æ¸…ç†æµ‹è¯•æ•°æ®ï¼ˆ5 åˆ†é’Ÿï¼‰

#### 5.1 å¤‡ä»½é…ç½®ï¼ˆå¯é€‰ï¼‰

```bash
cp python/config.yaml python/config.yaml.backup
cp config.json config.json.backup
```

#### 5.2 æ¸…ç©ºå½’æ¡£æ•°æ®

```bash
# åˆ é™¤æ‰€æœ‰æµ‹è¯•å½’æ¡£
rm -rf /home/ben/Download/t66y/*

# éªŒè¯
ls -la /home/ben/Download/t66y/
# åº”è¯¥æ˜¯ç©ºçš„ï¼ˆæˆ–åªæœ‰ .gitkeep ä¹‹ç±»çš„æ–‡ä»¶ï¼‰
```

#### 5.3 éªŒè¯é…ç½®å®Œæ•´

```bash
# ç¡®è®¤ config.yaml ä¸­çš„å…³æ³¨åˆ—è¡¨è¿˜åœ¨
cat python/config.yaml | grep -A 10 "followed_authors:"

# ç¡®è®¤æ•°æ®åº“è·¯å¾„ç­‰é…ç½®æ­£å¸¸
cat python/config.yaml | grep "database_path"
```

---

## äº”ã€éªŒæ”¶æ ‡å‡†

### 5.1 P0 æ ‡å‡†ï¼ˆå¿…é¡»é€šè¿‡ï¼‰

- [ ] **æ¨¡æ¿æ–‡ä»¶åˆ›å»ºæˆåŠŸ**
  - `python/src/templates/post.html` å­˜åœ¨ä¸”çº¦ 80 è¡Œ
  - `python/src/templates/filters.py` å­˜åœ¨ä¸”çº¦ 60 è¡Œ
  - `python/src/templates/__init__.py` å­˜åœ¨

- [ ] **Archiver ä¿®æ”¹æˆåŠŸ**
  - å¯¼å…¥ Jinja2 æ— é”™è¯¯
  - æ¨¡æ¿å¼•æ“åˆå§‹åŒ–æˆåŠŸ
  - å¯ä»¥ç”Ÿæˆ content.html

- [ ] **æ–°å½’æ¡£ä½¿ç”¨æ–°æ¨¡æ¿**
  - å½’æ¡£ 1 ä¸ªå¸–å­åï¼Œcontent.html åŒ…å« `<!DOCTYPE html>`
  - åŒ…å«å®Œæ•´çš„ `<html>`, `<head>`, `<body>` ç»“æ„
  - å…ƒæ•°æ®åœ¨ `<header>` ä¸­å¯è§

- [ ] **w3m æµè§ˆæ­£å¸¸**
  - `w3m content.html` å¯ä»¥æ‰“å¼€
  - æ ‡é¢˜ã€ä½œè€…ã€æ—¶é—´å¯è§
  - æ­£æ–‡æ®µè½æ¸…æ™°
  - é“¾æ¥å¯ä»¥ç‚¹å‡»ï¼ˆEnter é”®ï¼‰

### 5.2 P1 æ ‡å‡†ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

- [ ] **æ­£æ–‡æ ¼å¼æ­£ç¡®**
  - æ®µè½ç”¨ `<p>` æ ‡ç­¾åŒ…è£¹
  - ç« èŠ‚æ ‡é¢˜è¯†åˆ«ä¸º `<h2>`ï¼ˆå¦‚ "01. xxx"ï¼‰
  - è¿ç»­ `<br>` å·²è½¬æ¢ä¸ºæ®µè½åˆ†éš”

- [ ] **åª’ä½“åˆ—è¡¨å®Œæ•´**
  - å›¾ç‰‡åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰å›¾ç‰‡æ–‡ä»¶å
  - è§†é¢‘åˆ—è¡¨æ˜¾ç¤ºæ‰€æœ‰è§†é¢‘æ–‡ä»¶å
  - æœ¬åœ°æ–‡ä»¶é“¾æ¥å¯ç‚¹å‡»

- [ ] **ç»Ÿè®¡ä¿¡æ¯æ­£ç¡®**
  - é¡µè„šæ˜¾ç¤ºå­—ç¬¦æ•°ã€å›¾ç‰‡æ•°ã€è§†é¢‘æ•°
  - å½’æ¡£æ—¶é—´æ ¼å¼æ­£ç¡®ï¼ˆYYYY-MM-DD HH:MM:SSï¼‰

### 5.3 P2 æ ‡å‡†ï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰

- [ ] **æµè§ˆå™¨æ˜¾ç¤ºç¾è§‚**
  - Firefox/Chrome ä¸­æ‰“å¼€æ’ç‰ˆæ­£å¸¸
  - CSS æ ·å¼ç”Ÿæ•ˆ
  - å­—ä½“ã€é¢œè‰²ã€é—´è·åˆç†

- [ ] **æ–‡ä»¶å¤§å°æ˜¾ç¤º**
  - å›¾ç‰‡/è§†é¢‘æ˜¾ç¤ºæ–‡ä»¶å¤§å°ï¼ˆå¦‚ "1.2 MB"ï¼‰

---

## å…­ã€æµ‹è¯•æ¸…å•

### 6.1 å•å…ƒæµ‹è¯•

#### æµ‹è¯• 1: è¿‡æ»¤å™¨åŠŸèƒ½

```bash
cd python

# æµ‹è¯•å†…å®¹æ¸…ç†
python3 << 'EOF'
from src.templates.filters import clean_html_content

# æµ‹è¯•1: è½¬æ¢è¿ç»­ <br> ä¸ºæ®µè½
html = "ç¬¬ä¸€æ®µ<br><br>ç¬¬äºŒæ®µ<br><br><br>ç¬¬ä¸‰æ®µ"
result = clean_html_content(html)
assert '<p>' in result
assert '</p>' in result
print("âœ“ æµ‹è¯•1é€šè¿‡: æ®µè½è½¬æ¢")

# æµ‹è¯•2: è¯†åˆ«ç« èŠ‚æ ‡é¢˜
html = "<p>01. ç¬¬ä¸€ç« </p><p>æ­£æ–‡...</p>"
result = clean_html_content(html)
assert '<h2>01. ç¬¬ä¸€ç« </h2>' in result
print("âœ“ æµ‹è¯•2é€šè¿‡: ç« èŠ‚è¯†åˆ«")

# æµ‹è¯•3: ç§»é™¤å›¾ç‰‡ div
html = '<div class="image-big"><img src="..."></div>æ­£æ–‡'
result = clean_html_content(html)
assert 'image-big' not in result
print("âœ“ æµ‹è¯•3é€šè¿‡: å›¾ç‰‡ç§»é™¤")

# æµ‹è¯•4: ç§»é™¤è§†é¢‘æ ‡ç­¾
html = '<video src="..."></video>æ­£æ–‡'
result = clean_html_content(html)
assert '<video' not in result
print("âœ“ æµ‹è¯•4é€šè¿‡: è§†é¢‘ç§»é™¤")

print("\nâœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡")
EOF
```

#### æµ‹è¯• 2: æ¨¡æ¿æ¸²æŸ“

```bash
cd python

python3 << 'EOF'
from jinja2 import Environment, FileSystemLoader
from pathlib import Path

# åŠ è½½æ¨¡æ¿
template_dir = Path('src/templates')
env = Environment(loader=FileSystemLoader(str(template_dir)))
template = env.get_template('post.html')

# æµ‹è¯•æ•°æ®
data = {
    'title': 'æµ‹è¯•æ ‡é¢˜',
    'author': 'æµ‹è¯•ä½œè€…',
    'publish_time': '2026-02-12 10:00',
    'archive_time': '2026-02-12 10:05',
    'url': 'https://example.com/test',
    'content': '<p>æµ‹è¯•å†…å®¹</p>',
    'content_length': 100,
    'images': [
        {'filename': 'img_1.jpg', 'url': 'https://...', 'size': '1.2 MB'},
        {'filename': 'img_2.jpg', 'url': 'https://...', 'size': '800 KB'}
    ],
    'videos': []
}

# æ¸²æŸ“
html = template.render(**data)

# éªŒè¯
assert '<!DOCTYPE html>' in html
assert '<title>æµ‹è¯•æ ‡é¢˜ - æµ‹è¯•ä½œè€…</title>' in html
assert 'ä½œè€…: æµ‹è¯•ä½œè€…' in html
assert 'ğŸ“· å›¾ç‰‡ (2)' in html
assert 'img_1.jpg' in html

print("âœ… æ¨¡æ¿æ¸²æŸ“æµ‹è¯•é€šè¿‡")
EOF
```

### 6.2 é›†æˆæµ‹è¯•

#### æµ‹è¯• 3: å®Œæ•´å½’æ¡£æµç¨‹

```bash
cd python

# 1. å½’æ¡£ä¸€ä¸ªçº¯æ–‡æœ¬å¸–å­
python main.py
# æ‰‹åŠ¨æ“ä½œï¼š
# - é€‰æ‹© [3] ç«‹å³æ›´æ–°
# - é€‰æ‹©ä¸€ä¸ªä½œè€…ï¼ˆå¦‚"ç‹¬é†‰ç¬‘æ¸…é£"ï¼Œçº¯æ–‡æœ¬å¸–å­å¤šï¼‰
# - è®¾ç½® 1 é¡µ

# 2. æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶
TEXT_POST=$(find /home/ben/Download/t66y -name "content.html" -type f | head -1)
echo "æ£€æŸ¥æ–‡ä»¶: $TEXT_POST"

# éªŒè¯ HTML ç»“æ„
grep -q "<!DOCTYPE html>" "$TEXT_POST" && echo "âœ“ DOCTYPE å­˜åœ¨"
grep -q "<h1>" "$TEXT_POST" && echo "âœ“ æ ‡é¢˜å­˜åœ¨"
grep -q "ä½œè€…:" "$TEXT_POST" && echo "âœ“ å…ƒæ•°æ®å¯è§"
grep -q "<article>" "$TEXT_POST" && echo "âœ“ æ­£æ–‡ç»“æ„æ­£ç¡®"

# 3. w3m æŸ¥çœ‹ï¼ˆæ‰‹åŠ¨ï¼‰
w3m "$TEXT_POST"
```

#### æµ‹è¯• 4: å›¾ç‰‡å¸–å­

```bash
# å½’æ¡£ä¸€ä¸ªåŒ…å«å›¾ç‰‡çš„å¸–å­
python main.py
# é€‰æ‹©æœ‰å›¾ç‰‡çš„ä½œè€…ï¼ˆå¦‚"å¦é—¨ä¸€åªç‹¼"ï¼‰

# æ£€æŸ¥
IMG_POST=$(find /home/ben/Download/t66y -type d -name "*\[*P\]" | head -1)/content.html
echo "æ£€æŸ¥æ–‡ä»¶: $IMG_POST"

# éªŒè¯å›¾ç‰‡åˆ—è¡¨
grep -q "ğŸ“· å›¾ç‰‡" "$IMG_POST" && echo "âœ“ å›¾ç‰‡åˆ—è¡¨å­˜åœ¨"
grep -q "photo/" "$IMG_POST" && echo "âœ“ æœ¬åœ°æ–‡ä»¶é“¾æ¥å­˜åœ¨"
grep -q "<section>" "$IMG_POST" && echo "âœ“ åŒºåŸŸç»“æ„æ­£ç¡®"

# w3m æŸ¥çœ‹
w3m "$IMG_POST"
```

#### æµ‹è¯• 5: è§†é¢‘å¸–å­

```bash
# å½’æ¡£ä¸€ä¸ªåŒ…å«è§†é¢‘çš„å¸–å­
python main.py
# é€‰æ‹©æœ‰è§†é¢‘çš„ä½œè€…ï¼ˆå¦‚"æˆ‘æ˜¯æŠµè§¦æƒ…ç»ª"ï¼‰

# æ£€æŸ¥
VID_POST=$(find /home/ben/Download/t66y -type d -name "*\[*V\]" | head -1)/content.html
echo "æ£€æŸ¥æ–‡ä»¶: $VID_POST"

# éªŒè¯è§†é¢‘åˆ—è¡¨
grep -q "ğŸ¬ è§†é¢‘" "$VID_POST" && echo "âœ“ è§†é¢‘åˆ—è¡¨å­˜åœ¨"
grep -q "video/" "$VID_POST" && echo "âœ“ æœ¬åœ°æ–‡ä»¶é“¾æ¥å­˜åœ¨"

# w3m æŸ¥çœ‹
w3m "$VID_POST"
```

### 6.3 å›å½’æµ‹è¯•

#### æµ‹è¯• 6: ç¡®ä¿å…¶ä»–åŠŸèƒ½æœªå—å½±å“

```bash
cd python

# 1. æµ‹è¯•èœå•ç³»ç»Ÿ
python main.py
# æ‰‹åŠ¨éªŒè¯ï¼š
# - [1] å…³æ³¨æ–°ä½œè€… - æ­£å¸¸
# - [2] æŸ¥çœ‹å…³æ³¨åˆ—è¡¨ - æ­£å¸¸
# - [3] ç«‹å³æ›´æ–° - æ­£å¸¸ï¼ˆå·²æµ‹è¯•ï¼‰
# - [4] å–æ¶ˆå…³æ³¨ - æ­£å¸¸
# - [5] ç³»ç»Ÿè®¾ç½® - æ­£å¸¸

# 2. æµ‹è¯•é…ç½®åŠ è½½
python3 -c "from src.config.manager import ConfigManager; cm = ConfigManager(); config = cm.load(); print('âœ“ é…ç½®åŠ è½½æ­£å¸¸')"

# 3. æµ‹è¯•çˆ¬è™«åŠŸèƒ½ï¼ˆä¸å«æ¨¡æ¿ï¼‰
python3 -c "from src.scraper.extractor import PostExtractor; print('âœ“ æå–å™¨æ­£å¸¸')"
python3 -c "from src.scraper.downloader import MediaDownloader; print('âœ“ ä¸‹è½½å™¨æ­£å¸¸')"
```

---

## ä¸ƒã€å¯¹åç»­ Phase çš„å½±å“

### 7.1 Phase 3: æ•°æ®åº“ + ç»Ÿè®¡

#### å½±å“åˆ†æ

**ç®€åŒ–å‰ï¼ˆæœªåš Phase 2.5ï¼‰**ï¼š
```python
# Phase 3 éœ€è¦è§£æå¤šç§æ ¼å¼
def parse_content_html(html_file: Path) -> dict:
    content = html_file.read_text()

    # å¤æ‚ï¼šéœ€è¦åŒºåˆ†ä¸‰ç§æ ¼å¼
    if '<!-- å¸–å­å…ƒæ•°æ®' in content:
        # æ—§æ ¼å¼ï¼šä»æ³¨é‡Šæå–
        metadata = extract_from_comment(content)
    elif '<header>' in content:
        # æ–°æ ¼å¼ï¼šä»ç»“æ„æå–
        metadata = extract_from_structure(content)
    else:
        # å…¶ä»–æ ¼å¼ï¼šçŒœæµ‹
        metadata = guess_metadata(content)

    return metadata
```

**ç®€åŒ–åï¼ˆåšäº† Phase 2.5ï¼‰**ï¼š
```python
# Phase 3 åªéœ€è§£æç»Ÿä¸€æ ¼å¼
def parse_content_html(html_file: Path) -> dict:
    soup = BeautifulSoup(html_file.read_text(), 'html.parser')

    # ç®€å•ï¼šç›´æ¥æå–
    return {
        'title': soup.find('h1').text,
        'author': soup.find('div', class_='meta').find('b', text='ä½œè€…:').next_sibling.strip(),
        'publish_time': extract_meta_value(soup, 'å‘å¸ƒ:'),
        'archive_time': extract_meta_value(soup, 'å½’æ¡£:'),
        'url': soup.find('div', class_='meta').find('a')['href'],
        'content_length': int(soup.find('footer').text.split('å­—ç¬¦')[0].split()[-1]),
        'image_count': len(soup.find_all('section')[0].find_all('div', class_='file')) if soup.find_all('section') else 0,
        'video_count': len(soup.find_all('section')[1].find_all('div', class_='file')) if len(soup.find_all('section')) > 1 else 0
    }
```

#### èŠ‚çœæ—¶é—´

| ä»»åŠ¡ | ç®€åŒ–å‰ | ç®€åŒ–å | èŠ‚çœ |
|------|--------|--------|------|
| å†å²æ•°æ®å¯¼å…¥å·¥å…· | 2 å°æ—¶ | 0 å°æ—¶ | 2 å°æ—¶ |
| è§£æé€»è¾‘å®ç° | 1 å°æ—¶ | 0.5 å°æ—¶ | 0.5 å°æ—¶ |
| æµ‹è¯•éªŒè¯ | 1 å°æ—¶ | 0.5 å°æ—¶ | 0.5 å°æ—¶ |
| **æ€»è®¡** | **4 å°æ—¶** | **1 å°æ—¶** | **3 å°æ—¶** |

**Phase 3 æ€»å·¥æœŸ**ï¼š3-4 å¤© â†’ **2-3 å¤©**

### 7.2 Phase 4: æ•°æ®åˆ†æ + å¯è§†åŒ–

#### å½±å“

- âœ… è¯äº‘ç”Ÿæˆï¼šç›´æ¥ä»æ•°æ®åº“è¯»å–æ­£æ–‡ï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰
- âœ… æ—¶é—´åˆ†æï¼šå‘å¸ƒæ—¶é—´æ ¼å¼ç»Ÿä¸€ï¼Œè§£æç®€å•
- âœ… æŠ¥å‘Šç”Ÿæˆï¼šå¯ä»¥ç›´æ¥é“¾æ¥åˆ° content.htmlï¼ˆæ ¼å¼ç¾è§‚ï¼‰

### 7.3 é•¿æœŸç»´æŠ¤

- âœ… **æ‰©å±•æ€§å¼º**ï¼šæ·»åŠ æ–°å­—æ®µåªéœ€ä¿®æ”¹æ¨¡æ¿
- âœ… **æ˜“äºè°ƒè¯•**ï¼šHTML ç»“æ„æ¸…æ™°ï¼Œé—®é¢˜å®¹æ˜“å®šä½
- âœ… **é›¶æŠ€æœ¯å€º**ï¼šæ— å†å²åŒ…è¢±ï¼Œæ— å…¼å®¹é€»è¾‘

---

## å…«ã€å›æ»šæ–¹æ¡ˆ

### 8.1 å›æ»šåœºæ™¯

å¦‚æœ Phase 2.5 å‡ºç°ä¸¥é‡é—®é¢˜éœ€è¦å›æ»šï¼š

#### åœºæ™¯ 1: æ¨¡æ¿æ¸²æŸ“é”™è¯¯

**ç—‡çŠ¶**ï¼šç”Ÿæˆçš„ HTML æ ¼å¼é”™è¯¯ã€æ— æ³•æ‰“å¼€

**å›æ»šæ­¥éª¤**ï¼š
```bash
# 1. å›é€€ä»£ç 
git checkout v2.0  # å›åˆ° Phase 2 ç‰ˆæœ¬

# 2. åˆ é™¤æ–°å½’æ¡£çš„æ•°æ®ï¼ˆå¦‚æœæœ‰ï¼‰
rm -rf /home/ben/Download/t66y/*

# 3. é‡æ–°å½’æ¡£
cd python
python main.py
```

#### åœºæ™¯ 2: Jinja2 ä¾èµ–é—®é¢˜

**ç—‡çŠ¶**ï¼š`ModuleNotFoundError: No module named 'jinja2'`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å®‰è£…ä¾èµ–
pip install jinja2

# æˆ–å›æ»šåˆ° Phase 2
git checkout v2.0
```

### 8.2 å›æ»šé£é™©è¯„ä¼°

| é£é™© | å¯èƒ½æ€§ | å½±å“ | å¯¹ç­– |
|------|--------|------|------|
| æ¨¡æ¿è¯­æ³•é”™è¯¯ | ä½ | ä¸­ | å•å…ƒæµ‹è¯•è¦†ç›– |
| Jinja2 ä¾èµ–é—®é¢˜ | æä½ | ä½ | å·²åœ¨ requirements.txt |
| w3m ä¸å…¼å®¹ | ä½ | ä½ | å·²ç”¨åŸºç¡€ CSS |
| æ•°æ®ä¸¢å¤± | æä½ | é«˜ | æµ‹è¯•æ•°æ®å¯åˆ é™¤ |

**ç»“è®º**ï¼šå›æ»šé£é™©æä½ï¼Œå³ä½¿å›æ»šä¹Ÿä¸å½±å“åŠŸèƒ½ï¼ˆPhase 2 ä»å¯ç”¨ï¼‰

---

## ä¹ã€Git æäº¤ç­–ç•¥

### 9.1 åˆ†æ”¯ç®¡ç†

```bash
# åˆ›å»ºå¼€å‘åˆ†æ”¯
git checkout -b phase2.5-html-template

# å¼€å‘è¿‡ç¨‹ä¸­å®šæœŸæäº¤
git add python/src/templates/
git commit -m "feat(phase2.5): add Jinja2 templates"

git add python/src/scraper/archiver.py
git commit -m "feat(phase2.5): integrate template rendering in archiver"

# æµ‹è¯•é€šè¿‡ååˆå¹¶
git checkout main
git merge phase2.5-html-template --no-ff

# æ‰“æ ‡ç­¾
git tag -a v2.5 -m "Phase 2.5: HTML Template Optimization

- Unified content.html format
- w3m terminal browser optimization
- Visible metadata in header
- Local media file listing
- Simplified Phase 3 implementation

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

# æ¨é€
git push origin main --tags
```

### 9.2 æäº¤ä¿¡æ¯è§„èŒƒ

**æ ¼å¼**ï¼š`<type>(phase2.5): <subject>`

**ç±»å‹**ï¼š
- `feat`: æ–°åŠŸèƒ½
- `fix`: Bug ä¿®å¤
- `refactor`: é‡æ„
- `test`: æµ‹è¯•
- `docs`: æ–‡æ¡£

**ç¤ºä¾‹**ï¼š
```
feat(phase2.5): add Jinja2 templates for unified HTML
feat(phase2.5): add content cleaning filters
feat(phase2.5): integrate template rendering in archiver
test(phase2.5): add unit tests for filters
docs(phase2.5): add Phase 2.5 design document
```

---

## åã€æ€»ç»“

### 10.1 æ ¸å¿ƒä»·å€¼

1. **ç”¨æˆ·ä½“éªŒ** - w3m ç»ˆç«¯æµè§ˆä½“éªŒå¤§å¹…æå‡
2. **ä»£ç è´¨é‡** - ç»Ÿä¸€æ ¼å¼ï¼Œæ˜“äºç»´æŠ¤
3. **å¼€å‘æ•ˆç‡** - Phase 3 èŠ‚çœ 3 å°æ—¶å¼€å‘æ—¶é—´
4. **é›¶æŠ€æœ¯å€º** - æ— å†å²åŒ…è¢±ï¼Œæ— å…¼å®¹é€»è¾‘

### 10.2 å·¥ä½œé‡

| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | å®é™…æ—¶é—´ |
|------|---------|---------|
| åˆ›å»ºæ¨¡æ¿ | 15 åˆ†é’Ÿ | - |
| åˆ›å»ºè¿‡æ»¤å™¨ | 15 åˆ†é’Ÿ | - |
| ä¿®æ”¹ Archiver | 20 åˆ†é’Ÿ | - |
| æµ‹è¯•éªŒè¯ | 10 åˆ†é’Ÿ | - |
| æ¸…ç†æµ‹è¯•æ•°æ® | 5 åˆ†é’Ÿ | - |
| **æ€»è®¡** | **65 åˆ†é’Ÿ** | - |

### 10.3 éªŒæ”¶æ¸…å•

**P0ï¼ˆå¿…é¡»ï¼‰**ï¼š
- [ ] æ¨¡æ¿æ–‡ä»¶åˆ›å»ºæˆåŠŸï¼ˆpost.html, filters.pyï¼‰
- [ ] Archiver ä¿®æ”¹æˆåŠŸï¼ˆå¯¼å…¥ Jinja2, æ¸²æŸ“æ¨¡æ¿ï¼‰
- [ ] æ–°å½’æ¡£ä½¿ç”¨æ–°æ¨¡æ¿ï¼ˆåŒ…å« <!DOCTYPE html>ï¼‰
- [ ] w3m æµè§ˆæ­£å¸¸ï¼ˆæ ‡é¢˜ã€æ­£æ–‡ã€é“¾æ¥å¯ç‚¹å‡»ï¼‰

**P1ï¼ˆå»ºè®®ï¼‰**ï¼š
- [ ] æ­£æ–‡æ ¼å¼æ­£ç¡®ï¼ˆæ®µè½ã€ç« èŠ‚æ ‡é¢˜ï¼‰
- [ ] åª’ä½“åˆ—è¡¨å®Œæ•´ï¼ˆå›¾ç‰‡ã€è§†é¢‘æ–‡ä»¶åï¼‰
- [ ] ç»Ÿè®¡ä¿¡æ¯æ­£ç¡®ï¼ˆå­—ç¬¦æ•°ã€å›¾ç‰‡æ•°ã€è§†é¢‘æ•°ï¼‰

**P2ï¼ˆå¯é€‰ï¼‰**ï¼š
- [ ] æµè§ˆå™¨æ˜¾ç¤ºç¾è§‚
- [ ] æ–‡ä»¶å¤§å°æ˜¾ç¤º

### 10.4 ä¸‹ä¸€æ­¥

å®Œæˆ Phase 2.5 åï¼š
1. âœ… æ¸…ç†æµ‹è¯•æ•°æ®ï¼ˆ`rm -rf /home/ben/Download/t66y/*`ï¼‰
2. âœ… æ›´æ–° MIGRATION_PROGRESS.mdï¼ˆæ ‡è®° Phase 2.5 å®Œæˆï¼‰
3. âœ… å¯åŠ¨ Phase 3 æ•°æ®åº“å¼€å‘ï¼ˆ2-3 å¤©ï¼‰

---

**Phase 2.5 è®¾è®¡æ–‡æ¡£å®Œæˆï¼**

**é¢„è®¡å·¥æœŸ**ï¼š1 å°æ—¶
**å»ºè®®ä¼˜å…ˆçº§**ï¼šP1ï¼ˆé«˜ï¼‰
**éªŒæ”¶æ ‡å‡†**ï¼š4 é¡¹ P0 + 3 é¡¹ P1
**å¯¹ Phase 3 å½±å“**ï¼šèŠ‚çœ 3 å°æ—¶å¼€å‘æ—¶é—´

**å‡†å¤‡å°±ç»ªï¼Œç­‰å¾…ç”¨æˆ·æ‰¹å‡†åå¼€å§‹å®æ–½ï¼**
