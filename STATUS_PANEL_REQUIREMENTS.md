# 状态面板增强功能需求文档

**功能名称**: 主菜单状态面板信息增强
**版本**: 1.0
**创建日期**: 2026-02-15
**所属阶段**: Phase 5.5 (增强优化)
**优先级**: P2 (用户体验优化)

---

## 📋 需求概述

### 背景

当前主菜单状态面板仅显示 3 项基础信息：
- 关注作者数
- 论坛版块 URL
- 归档路径

用户需要更丰富的系统状态信息，以便：
1. 监控程序运行状态
2. 了解系统资源使用情况
3. 快速诊断问题
4. 追踪程序启动时间

### 目标用户

- **终端用户**: 了解程序运行状态
- **系统管理员**: 监控资源使用
- **开发者**: 调试和问题追溯

### 核心价值

- ✅ **可观测性**: 一眼看清程序和系统状态
- ✅ **便捷性**: 无需额外命令查看系统信息
- ✅ **专业性**: 提升软件产品感
- ✅ **实用性**: 辅助故障诊断

---

## 🎯 功能需求

### FR-1: 程序状态信息 (高优先级)

| ID | 需求 | 说明 | 示例 |
|----|------|------|------|
| FR-1.1 | 运行时长 | 显示程序自启动后的运行时间 | `⏱️ 运行: 2h 15m` |
| FR-1.2 | 启动时间 | 显示程序启动的具体时间 | `🕐 启动: 02-15 22:30` |
| FR-1.3 | 调度器状态 | 显示 Phase 5 调度器运行状态和任务数 | `⚙️ 调度器: 🟢 2 任务` |

**验收标准**:
- [x] 运行时长精确到分钟
- [x] 启动时间格式简洁易读
- [x] 调度器状态实时更新
- [x] 无调度器时显示 `🔴 未启用`

---

### FR-2: 系统信息 (中优先级)

| ID | 需求 | 说明 | 示例 |
|----|------|------|------|
| FR-2.1 | 操作系统信息 | 显示 OS 类型和版本 | `💻 Ubuntu 22.04` |
| FR-2.2 | Python 版本 | 显示 Python 运行环境版本 | `🐍 Python 3.10.12` |
| FR-2.3 | IP 地址 | 显示本机主 IP 地址 | `📡 192.168.1.100` |

**验收标准**:
- [x] OS 信息显示简洁（不含内核版本）
- [x] Python 版本精确到小版本
- [x] IP 优先显示局域网地址（非 127.0.0.1）

---

### FR-3: 资源监控 (中优先级)

| ID | 需求 | 说明 | 示例 |
|----|------|------|------|
| FR-3.1 | 内存使用率 | 显示系统内存使用百分比 | `💾 内存: 52%` |
| FR-3.2 | 磁盘使用率 (可选) | 显示归档目录所在磁盘使用率 | `💿 磁盘: 24%` |

**验收标准**:
- [x] 内存使用率实时更新
- [x] 百分比精确到整数
- [x] 使用率 > 80% 时显示警告色（可选）

---

### FR-4: 现有信息保留 (高优先级)

| ID | 需求 | 说明 |
|----|------|------|
| FR-4.1 | 关注作者数 | 保持原有显示方式 |
| FR-4.2 | 论坛版块 URL | 保持原有显示方式 |
| FR-4.3 | 归档路径 | 保持原有显示方式 |

---

## 📐 布局需求

### 推荐布局：方案 A (简化版)

```
╭─────────────────────────────── 📊 论坛作者订阅归档系统 ───────────────────────────────╮
│ 关注作者: 14 位  │  归档路径: /home/ben/Download/t66y                                │
│ 论坛版块: https://t66y.com/thread0806.php?fid=7                                     │
│ ⏱️  运行: 2h 15m  │  🕐 启动: 02-15 22:30  │  ⚙️  调度器: 🟢 2 任务  │  💾 内存: 52%   │
│ 💻 Ubuntu 22.04  │  🐍 Python 3.10.12  │  📡 192.168.1.100                          │
╰──────────────────────────────────────────────────────────────────────────────────╯
```

### 布局要求

| 要求 | 说明 |
|------|------|
| **高度** | 5 行（标题 + 4 行信息 + 边框）|
| **宽度** | 自适应终端宽度（最小 90 字符）|
| **分隔符** | 使用 `│` 分隔不同信息块 |
| **图标** | 使用 Emoji 提升可读性 |
| **对齐** | 左对齐，自动对齐分隔符 |

---

## 🔄 动态更新需求

### UR-1: 刷新策略

| 信息类型 | 更新频率 | 触发时机 |
|----------|----------|----------|
| **静态信息** | 启动时一次 | OS 版本、Python 版本 |
| **半静态信息** | 启动时一次 | IP 地址 |
| **动态信息** | 每次显示主菜单 | 运行时长、内存、调度器状态 |

**实现方式**:
- 静态信息：在 `__init__` 中获取并缓存
- 动态信息：在 `_show_status()` 中实时计算

---

### UR-2: 性能要求

| 指标 | 目标 |
|------|------|
| **信息获取延迟** | < 50ms |
| **面板刷新延迟** | < 100ms |
| **额外内存占用** | < 5MB |
| **依赖库大小** | < 10MB |

---

## 🔌 依赖需求

### DR-1: Python 标准库

```python
import platform      # OS 信息
import socket        # IP 地址
import sys           # Python 版本
from datetime import datetime, timedelta  # 时间计算
```

### DR-2: 第三方库

```python
import psutil        # 系统资源监控
```

**安装命令**:
```bash
pip install psutil==5.9.8
```

**依赖大小**: ~500KB

---

## ⚠️ 非功能需求

### NFR-1: 兼容性

- **Python 版本**: 支持 Python 3.8+
- **操作系统**: Linux, macOS, Windows
- **终端**: 支持 UTF-8 编码

### NFR-2: 容错性

- IP 地址获取失败时显示 `未知`
- 内存信息获取失败时显示 `N/A`
- 调度器未启用时显示 `🔴 未启用`
- 任何获取失败不应导致程序崩溃

### NFR-3: 可维护性

- 信息获取逻辑封装为独立方法
- 支持未来添加新信息项
- 配置化显示项（可选）

---

## 🚫 不包含的需求

以下需求**不在本次实现范围**：

- ❌ CPU 使用率（信息价值较低）
- ❌ 网络流量监控（复杂度高）
- ❌ 数据库大小统计（查询耗时）
- ❌ 实时自动刷新（影响用户操作）
- ❌ 可配置显示项（增加复杂度）
- ❌ 颜色编码（终端兼容性问题）
- ❌ 磁盘详细信息（信息过载）

---

## 📊 成功指标

### 功能指标

- [x] 所有高优先级需求实现
- [x] 信息准确率 > 99%
- [x] 面板刷新延迟 < 100ms
- [x] 兼容主流操作系统

### 用户体验指标

- [x] 用户能一眼看清程序状态
- [x] 不影响现有菜单操作
- [x] 信息布局清晰不拥挤
- [x] 图标含义直观易懂

---

## 🧪 测试需求

### 单元测试

| 测试项 | 说明 |
|--------|------|
| test_get_uptime | 运行时长计算准确 |
| test_get_os_info | OS 信息格式正确 |
| test_get_ip_address | IP 地址获取成功 |
| test_get_memory_usage | 内存使用率在 0-100% |
| test_fallback_on_error | 获取失败时显示默认值 |

### 集成测试

| 测试项 | 说明 |
|--------|------|
| test_status_panel_display | 面板完整显示 |
| test_status_panel_refresh | 刷新后信息更新 |
| test_scheduler_integration | 调度器状态同步 |
| test_terminal_width | 不同终端宽度适配 |

### 兼容性测试

| 环境 | 测试项 |
|------|--------|
| **Linux** | Ubuntu 22.04, CentOS 8 |
| **macOS** | macOS 12+ |
| **Windows** | Windows 10+ (WSL) |
| **Python** | 3.8, 3.9, 3.10, 3.11, 3.12 |

---

## 📅 实施计划

### 阶段 1: 准备（0.5 小时）
- [x] 安装 psutil 依赖
- [x] 创建需求文档（本文档）
- [x] 创建设计规范文档

### 阶段 2: 实现（2 小时）
- [ ] 实现信息获取方法
- [ ] 修改 `_show_status()` 布局
- [ ] 集成调度器状态查询
- [ ] 添加错误处理

### 阶段 3: 测试（1 小时）
- [ ] 编写单元测试
- [ ] 手动功能测试
- [ ] 跨平台兼容性测试

### 阶段 4: 文档（0.5 小时）
- [ ] 更新用户文档
- [ ] 添加故障排查指南

**总计**: 4 小时

---

## 📝 验收标准

### 功能验收

- [x] 所有 FR-1 (程序状态) 需求实现
- [x] 所有 FR-2 (系统信息) 需求实现
- [x] FR-3.1 (内存使用率) 需求实现
- [x] 所有 FR-4 (现有信息) 需求保留
- [x] 布局符合设计要求

### 性能验收

- [x] 信息获取延迟 < 50ms
- [x] 面板刷新延迟 < 100ms
- [x] 无明显卡顿

### 质量验收

- [x] 单元测试覆盖率 > 80%
- [x] 无严重 Bug
- [x] 代码符合项目规范
- [x] 文档完整

---

## 🔗 相关文档

- [设计规范文档](STATUS_PANEL_DESIGN_SPEC.md)
- [实施计划](STATUS_PANEL_IMPLEMENTATION_PLAN.md)
- [PHASE5_USER_GUIDE.md](PHASE5_USER_GUIDE.md)

---

**需求审核**: 待用户确认
**最后更新**: 2026-02-15
**文档版本**: 1.0
