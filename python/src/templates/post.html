<!--
    æ¨¡æ¿ç‰ˆæœ¬: v2.7
    æ›´æ–°æ—¥æœŸ: 2026-02-14
    æ–°å¢åŠŸèƒ½:
    - âœ… å›¾ç‰‡åµŒå…¥æ˜¾ç¤ºï¼ˆ<img> æ ‡ç­¾ï¼‰
    - âœ… è§†é¢‘åµŒå…¥æ’­æ”¾ï¼ˆ<video> æ ‡ç­¾ï¼‰
    - âœ… å›¾ç‰‡ç¯ç®±åŠŸèƒ½ï¼ˆåŸç”Ÿ JSï¼‰
    - âœ… é”®ç›˜å¯¼èˆªæ”¯æŒï¼ˆESC, â† â†’ï¼‰
    - âœ… è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒï¼ˆç§»åŠ¨ç«¯ï¼‰
    - âœ… å“åº”å¼è®¾è®¡
    - âœ… w3m ç»ˆç«¯æµè§ˆå™¨å…¼å®¹
    - âœ… EXIF ç…§ç‰‡ä¿¡æ¯é™æ€æ˜¾ç¤ºï¼ˆv2.7ï¼‰
-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - {{ author }}</title>
    <style>
        /* æç®€ CSSï¼Œw3m å‹å¥½ */
        body {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
            line-height: 1.6;
            font-family: monospace;
        }
        h1 {
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .meta {
            color: #666;
            margin: 5px 0;
            font-size: 0.95em;
        }
        .meta b {
            color: #000;
        }
        article {
            margin: 30px 0;
        }
        article p {
            margin: 10px 0;
            text-indent: 2em;
        }
        article h2 {
            font-size: 1.3em;
            margin: 25px 0 15px 0;
            border-bottom: 1px solid #999;
            padding-bottom: 5px;
        }
        section {
            margin: 30px 0;
            border-top: 1px solid #ddd;
            padding-top: 20px;
        }
        section h2 {
            font-size: 1.2em;
            border-bottom: none;
        }
        .file {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #ccc;
            padding-left: 10px;
        }
        .file a {
            color: #06c;
            text-decoration: none;
        }
        .file a:hover {
            text-decoration: underline;
        }
        footer {
            border-top: 1px solid #ccc;
            margin-top: 30px;
            padding-top: 10px;
            color: #666;
            font-size: 0.9em;
        }

        /* ============ åª’ä½“æ˜¾ç¤ºå¢å¼º ============ */

        /* å›¾ç‰‡å®¹å™¨ */
        .images-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .image-item {
            position: relative;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            background: #f9f9f9;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .image-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
        }

        /* å›¾ç‰‡æœ¬ä½“ */
        .image-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        /* å›¾ç‰‡ä¿¡æ¯æ¡ */
        .image-info {
            padding: 8px;
            font-size: 0.85em;
            background: white;
            border-top: 1px solid #eee;
        }

        .image-info .index {
            font-weight: bold;
            color: #06c;
        }

        .image-info .size {
            color: #666;
            float: right;
        }

        /* ============ EXIF ç…§ç‰‡ä¿¡æ¯ï¼ˆé™æ€æ˜¾ç¤ºï¼‰============ */

        /* EXIF ä¿¡æ¯å®¹å™¨ */
        .exif-info {
            background: #f5f5f5;
            border-top: 1px solid #e0e0e0;
            padding: 8px 10px;
            font-size: 0.75em;
            color: #333;
            line-height: 1.5;
        }

        /* EXIF æ¯ä¸€è¡Œ */
        .exif-line {
            display: flex;
            align-items: center;
            margin: 3px 0;
            min-height: 16px;
        }

        /* EXIF å›¾æ ‡ */
        .exif-icon {
            font-size: 1.1em;
            margin-right: 5px;
            flex-shrink: 0;
            width: 18px;
            text-align: center;
        }

        /* EXIF æ–‡æœ¬ */
        .exif-text {
            color: #555;
            word-break: break-word;
            flex: 1;
        }

        /* ç¯ç®±ä¸­çš„ EXIF ä¿¡æ¯å¢å¼º */
        .lightbox-info .exif-details {
            display: block;
            margin-top: 5px;
            font-size: 0.9em;
            opacity: 0.9;
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 600px) {
            .exif-info {
                font-size: 0.7em;
                padding: 6px 8px;
            }

            .exif-icon {
                font-size: 1em;
                width: 16px;
                margin-right: 4px;
            }
        }

        /* ä¸‹è½½é“¾æ¥ */
        .download-link {
            display: block;
            text-align: center;
            padding: 5px;
            margin-top: 5px;
            background: #f0f0f0;
            color: #06c;
            text-decoration: none;
            font-size: 0.85em;
            border-radius: 3px;
        }

        .download-link:hover {
            background: #e0e0e0;
            text-decoration: underline;
        }

        /* è§†é¢‘å®¹å™¨ */
        .videos-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .video-item {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            background: #000;
        }

        /* è§†é¢‘æ’­æ”¾å™¨ */
        .video-item video {
            width: 100%;
            height: auto;
            display: block;
            background: #000;
        }

        /* è§†é¢‘ä¿¡æ¯ */
        .video-info {
            padding: 8px;
            background: white;
            border-top: 1px solid #eee;
            font-size: 0.85em;
        }

        .video-info .index {
            font-weight: bold;
            color: #06c;
        }

        .video-info .size {
            color: #666;
            float: right;
        }

        /* ============ å›¾ç‰‡ç¯ç®± ============ */

        /* ç¯ç®±å®¹å™¨ï¼ˆå…¨å±é®ç½©ï¼‰ */
        .lightbox {
            display: none; /* é»˜è®¤éšè— */
            position: fixed;
            z-index: 9999;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .lightbox.active {
            display: flex;
        }

        /* æ·¡å…¥åŠ¨ç”» */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* ç¼©æ”¾åŠ¨ç”» */
        @keyframes zoomIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* å…³é—­æŒ‰é’®ï¼ˆå³ä¸Šè§’ Xï¼‰ */
        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 40px;
            font-size: 40px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            z-index: 10001;
            transition: color 0.3s;
        }

        .lightbox-close:hover {
            color: #f44;
        }

        /* ç¯ç®±å†…å®¹å®¹å™¨ */
        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: zoomIn 0.3s ease;
        }

        /* ç¯ç®±å›¾ç‰‡ */
        .lightbox-content img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 4px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        /* å›¾ç‰‡ä¿¡æ¯æ  */
        .lightbox-info {
            margin-top: 15px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: white;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        /* å‰ä¸€å¼ æŒ‰é’®ï¼ˆå·¦ä¾§ <ï¼‰ */
        .lightbox-prev,
        .lightbox-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 30px;
            font-weight: bold;
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 15px 20px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.3s, transform 0.2s;
            z-index: 10001;
            backdrop-filter: blur(5px);
        }

        .lightbox-prev {
            left: 40px;
        }

        .lightbox-next {
            right: 40px;
        }

        .lightbox-prev:hover,
        .lightbox-next:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-50%) scale(1.1);
        }

        .lightbox-prev:active,
        .lightbox-next:active {
            transform: translateY(-50%) scale(0.95);
        }

        /* å“åº”å¼ï¼šç§»åŠ¨ç«¯å•åˆ— */
        @media (max-width: 600px) {
            .images-gallery {
                grid-template-columns: 1fr;
            }

            .image-item img {
                height: auto;
                max-height: 300px;
            }

            .videos-gallery {
                grid-template-columns: 1fr;
            }

            .lightbox-close {
                top: 10px;
                right: 20px;
                font-size: 30px;
            }

            .lightbox-prev,
            .lightbox-next {
                font-size: 24px;
                padding: 10px 15px;
            }

            .lightbox-prev {
                left: 10px;
            }

            .lightbox-next {
                right: 10px;
            }

            .lightbox-content {
                max-width: 95%;
            }

            .lightbox-info {
                font-size: 0.8em;
                padding: 8px 15px;
            }
        }

        /* w3m ç»ˆç«¯æµè§ˆå™¨å…¼å®¹ */
        @media (max-width: 1px) {
            .lightbox {
                display: none !important;
            }
        }
    </style>
</head>
<body>

<!-- å¤´éƒ¨ï¼šå…ƒæ•°æ® -->
<header>
    <h1>{{ title }}</h1>
    <div class="meta">
        <b>ä½œè€…:</b> {{ author }} |
        <b>å‘å¸ƒ:</b> {{ publish_time }} |
        <b>å½’æ¡£:</b> {{ archive_time }}
    </div>
    <div class="meta">
        <b>åŸæ–‡:</b> <a href="{{ url }}">{{ url }}</a>
    </div>
</header>

<!-- æ­£æ–‡ -->
<article>
    {{ content|safe }}
</article>

<!-- å›¾ç‰‡åˆ—è¡¨ -->
{% if images %}
<section>
    <h2>ğŸ“· å›¾ç‰‡ ({{ images|length }})</h2>
    <div class="images-gallery">
        {% for img in images %}
        <div class="image-item" onclick="openLightbox({{ loop.index0 }})">
            <img
                src="photo/{{ img.filename }}"
                alt="å›¾ç‰‡ {{ loop.index }}"
                loading="lazy"
                onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI2VlZSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5Ij7liqDovb3lpLHotKU8L3RleHQ+PC9zdmc+'"
            >

            <div class="image-info">
                <span class="index">[{{ loop.index }}]</span>
                {% if img.size %}
                <span class="size">{{ img.size }}</span>
                {% endif %}
            </div>

            <!-- EXIF ç…§ç‰‡ä¿¡æ¯ï¼ˆé™æ€æ˜¾ç¤ºï¼‰-->
            {% if img.exif %}
            <div class="exif-info">
                {% if img.exif.make or img.exif.model %}
                <div class="exif-line">
                    <span class="exif-icon">ğŸ“·</span>
                    <span class="exif-text">
                    {% if img.exif.make and img.exif.model %}
                        {{ img.exif.make }} {{ img.exif.model }}
                    {% elif img.exif.model %}
                        {{ img.exif.model }}
                    {% else %}
                        {{ img.exif.make }}
                    {% endif %}
                    </span>
                </div>
                {% endif %}

                {% if img.exif.aperture or img.exif.shutter_speed or img.exif.iso or img.exif.focal_length %}
                <div class="exif-line">
                    <span class="exif-icon">âš™ï¸</span>
                    <span class="exif-text">
                    {% if img.exif.aperture %}f/{{ img.exif.aperture }}{% endif %}
                    {% if img.exif.shutter_speed %}{% if img.exif.aperture %} Â· {% endif %}{{ img.exif.shutter_speed }}s{% endif %}
                    {% if img.exif.iso %}{% if img.exif.aperture or img.exif.shutter_speed %} Â· {% endif %}ISO{{ img.exif.iso }}{% endif %}
                    {% if img.exif.focal_length %}{% if img.exif.aperture or img.exif.shutter_speed or img.exif.iso %} Â· {% endif %}{{ img.exif.focal_length }}mm{% endif %}
                    </span>
                </div>
                {% endif %}

                {% if img.exif.datetime %}
                <div class="exif-line">
                    <span class="exif-icon">ğŸ•</span>
                    <span class="exif-text">{{ img.exif.datetime }}</span>
                </div>
                {% endif %}

                {% if img.exif.location %}
                <div class="exif-line">
                    <span class="exif-icon">ğŸ“</span>
                    <span class="exif-text">{{ img.exif.location }}</span>
                </div>
                {% endif %}
            </div>
            {% endif %}

            <a href="photo/{{ img.filename }}" class="download-link" download onclick="event.stopPropagation()">
                â¬‡ ä¸‹è½½
            </a>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- è§†é¢‘åˆ—è¡¨ -->
{% if videos %}
<section>
    <h2>ğŸ¬ è§†é¢‘ ({{ videos|length }})</h2>
    <div class="videos-gallery">
        {% for vid in videos %}
        <div class="video-item">
            <video
                controls
                preload="metadata"
                poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNjQwIiBoZWlnaHQ9IjM2MCIgZmlsbD0iIzAwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0ibWlkZGxlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjI0IiBmaWxsPSIjZmZmIj7igLbvuI8g54K55Ye75pKt5pS+PC90ZXh0Pjwvc3ZnPg=="
            >
                <source src="video/{{ vid.filename }}" type="video/mp4">
                <source src="video/{{ vid.filename }}" type="video/webm">
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
            </video>
            <div class="video-info">
                <span class="index">[{{ loop.index }}]</span>
                <span>{{ vid.filename }}</span>
                {% if vid.size %}
                <span class="size">{{ vid.size }}</span>
                {% endif %}
            </div>
            <a href="video/{{ vid.filename }}" class="download-link" download>
                â¬‡ ä¸‹è½½è§†é¢‘
            </a>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- é¡µè„šï¼šç»Ÿè®¡ -->
<footer>
    <p>
        <b>ç»Ÿè®¡:</b> {{ content_length }} å­—ç¬¦ |
        {{ images|length }} å›¾ç‰‡ |
        {{ videos|length }} è§†é¢‘
    </p>
    <p>
        <b>å½’æ¡£:</b> {{ archive_time }} |
        <b>ç”Ÿæˆå™¨:</b> Python Scraper v2.6 (Playwright + Jinja2 + JS Lightbox)
    </p>
    <p>
        <b>ç»ˆç«¯æµè§ˆ:</b> <code>w3m content.html</code>
    </p>
</footer>

<!-- å›¾ç‰‡ç¯ç®± -->
<div id="lightbox" class="lightbox" onclick="closeLightbox()">
    <span class="lightbox-close" onclick="closeLightbox()">&times;</span>

    <button class="lightbox-prev" onclick="changeImage(-1); event.stopPropagation()">
        &#10094;
    </button>

    <div class="lightbox-content" onclick="event.stopPropagation()">
        <img id="lightbox-img" src="" alt="ç¯ç®±å›¾ç‰‡">
        <div class="lightbox-info">
            <span id="lightbox-caption">å›¾ç‰‡ 1 / 1</span>
        </div>
    </div>

    <button class="lightbox-next" onclick="changeImage(1); event.stopPropagation()">
        &#10095;
    </button>
</div>

<script>
// ============ å›¾ç‰‡ç¯ç®±åŠŸèƒ½ ============

// å…¨å±€å˜é‡
let currentImageIndex = 0;
const images = [
    {% for img in images %}
    {
        src: 'photo/{{ img.filename }}',
        alt: 'å›¾ç‰‡ {{ loop.index }}',
        caption: '[{{ loop.index }}] {{ img.filename }}{% if img.size %} ({{ img.size }}){% endif %}',
        exif: {% if img.exif %}{
            camera: '{% if img.exif.make and img.exif.model %}{{ img.exif.make }} {{ img.exif.model }}{% elif img.exif.model %}{{ img.exif.model }}{% elif img.exif.make %}{{ img.exif.make }}{% endif %}',
            params: '{% if img.exif.aperture %}f/{{ img.exif.aperture }}{% endif %}{% if img.exif.shutter_speed %} Â· {{ img.exif.shutter_speed }}s{% endif %}{% if img.exif.iso %} Â· ISO{{ img.exif.iso }}{% endif %}{% if img.exif.focal_length %} Â· {{ img.exif.focal_length }}mm{% endif %}',
            datetime: '{% if img.exif.datetime %}{{ img.exif.datetime }}{% endif %}',
            location: '{% if img.exif.location %}{{ img.exif.location }}{% endif %}'
        }{% else %}null{% endif %}
    }{% if not loop.last %},{% endif %}
    {% endfor %}
];
const totalImages = images.length;

/**
 * æ‰“å¼€ç¯ç®±
 * @param {number} index - å›¾ç‰‡ç´¢å¼•ï¼ˆä» 0 å¼€å§‹ï¼‰
 */
function openLightbox(index) {
    if (totalImages === 0) return;

    currentImageIndex = index;
    const lightbox = document.getElementById('lightbox');
    lightbox.classList.add('active');

    updateLightboxImage();

    // ç¦æ­¢é¡µé¢æ»šåŠ¨
    document.body.style.overflow = 'hidden';
}

/**
 * å…³é—­ç¯ç®±
 */
function closeLightbox() {
    const lightbox = document.getElementById('lightbox');
    lightbox.classList.remove('active');

    // æ¢å¤é¡µé¢æ»šåŠ¨
    document.body.style.overflow = 'auto';
}

/**
 * åˆ‡æ¢å›¾ç‰‡
 * @param {number} direction - æ–¹å‘ï¼ˆ-1 = ä¸Šä¸€å¼ ï¼Œ1 = ä¸‹ä¸€å¼ ï¼‰
 */
function changeImage(direction) {
    if (totalImages === 0) return;

    currentImageIndex += direction;

    // å¾ªç¯åˆ‡æ¢
    if (currentImageIndex < 0) {
        currentImageIndex = totalImages - 1;
    } else if (currentImageIndex >= totalImages) {
        currentImageIndex = 0;
    }

    updateLightboxImage();
}

/**
 * æ›´æ–°ç¯ç®±å›¾ç‰‡
 */
function updateLightboxImage() {
    const img = document.getElementById('lightbox-img');
    const caption = document.getElementById('lightbox-caption');

    const currentImage = images[currentImageIndex];

    img.src = currentImage.src;
    img.alt = currentImage.alt;

    // æ„å»ºcaptionï¼ŒåŒ…å«EXIFä¿¡æ¯
    let captionText = currentImage.caption;

    if (currentImage.exif && (currentImage.exif.camera || currentImage.exif.params || currentImage.exif.datetime || currentImage.exif.location)) {
        captionText += '<br><span class="exif-details">';

        if (currentImage.exif.camera) {
            captionText += 'ğŸ“· ' + currentImage.exif.camera;
        }

        if (currentImage.exif.params) {
            if (currentImage.exif.camera) captionText += ' Â· ';
            captionText += currentImage.exif.params;
        }

        if (currentImage.exif.datetime) {
            captionText += '<br>ğŸ• ' + currentImage.exif.datetime;
        }

        if (currentImage.exif.location) {
            if (currentImage.exif.datetime) captionText += ' Â· ';
            else captionText += '<br>';
            captionText += 'ğŸ“ ' + currentImage.exif.location;
        }

        captionText += '</span>';
    }

    caption.innerHTML = captionText;
}

/**
 * é”®ç›˜äº‹ä»¶ç›‘å¬
 */
document.addEventListener('keydown', function(event) {
    const lightbox = document.getElementById('lightbox');

    // åªåœ¨ç¯ç®±æ‰“å¼€æ—¶å“åº”
    if (!lightbox.classList.contains('active')) return;

    switch(event.key) {
        case 'Escape':
            closeLightbox();
            break;
        case 'ArrowLeft':
            changeImage(-1);
            break;
        case 'ArrowRight':
            changeImage(1);
            break;
    }
});

// ============ å¯é€‰ï¼šè§¦æ‘¸æ‰‹åŠ¿æ”¯æŒï¼ˆç§»åŠ¨ç«¯ï¼‰ ============

let touchStartX = 0;
let touchEndX = 0;

document.addEventListener('touchstart', function(event) {
    const lightbox = document.getElementById('lightbox');
    if (!lightbox.classList.contains('active')) return;

    touchStartX = event.changedTouches[0].screenX;
}, false);

document.addEventListener('touchend', function(event) {
    const lightbox = document.getElementById('lightbox');
    if (!lightbox.classList.contains('active')) return;

    touchEndX = event.changedTouches[0].screenX;
    handleSwipe();
}, false);

function handleSwipe() {
    const swipeThreshold = 50; // æœ€å°æ»‘åŠ¨è·ç¦»

    if (touchEndX < touchStartX - swipeThreshold) {
        // å‘å·¦æ»‘åŠ¨ â†’ ä¸‹ä¸€å¼ 
        changeImage(1);
    }

    if (touchEndX > touchStartX + swipeThreshold) {
        // å‘å³æ»‘åŠ¨ â†’ ä¸Šä¸€å¼ 
        changeImage(-1);
    }
}
</script>

</body>
</html>
