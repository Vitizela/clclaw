# 相机排行图中文显示问题解决方案

## 问题描述

相机排行图的标题和坐标轴标签显示为方块（□），无法正常显示中文。

## 根本原因

系统缺少完整的中文字体，或 matplotlib 未正确配置中文字体。当前使用的 `Droid Sans Fallback` 字体虽然包含中文字符，但某些字形可能不完整。

---

## 解决方案

### 方案 1: 安装文泉驿字体（推荐 ⭐）

文泉驿（WenQuanYi）字体是开源的高质量中文字体，广泛用于 Linux 系统。

```bash
# Ubuntu/Debian
sudo apt install fonts-wqy-zenhei

# Fedora/CentOS
sudo yum install wqy-zenhei-fonts

# Arch Linux
sudo pacman -S wqy-zenhei
```

安装后运行修复脚本：
```bash
python fix_camera_ranking.py
```

---

### 方案 2: 使用修复脚本（临时方案）

我已经创建了一个修复脚本，可以重新生成相机排行图：

```bash
cd /home/ben/gemini-work/gemini-t66y/python
python fix_camera_ranking.py
```

这个脚本会：
1. 尝试使用最佳可用的中文字体
2. 如果字体不可用，使用英文标签作为后备
3. 生成新的相机排行图

---

### 方案 3: 手动下载字体（无需 root）

如果无法使用 `sudo`，可以手动下载字体到用户目录：

```bash
# 创建字体目录
mkdir -p ~/.fonts

# 下载文泉驿正黑字体（示例）
cd ~/.fonts
wget https://github.com/anthonyfok/fonts-wqy-zenhei/raw/master/wqy-zenhei.ttc

# 更新字体缓存
fc-cache -fv

# 清理 matplotlib 缓存
rm -rf ~/.cache/matplotlib
```

然后重新运行：
```bash
python fix_camera_ranking.py
```

---

### 方案 4: 修改代码使用英文标签

如果暂时无法解决字体问题，可以修改代码使用英文标签：

编辑 `python/src/analysis/time_analyzer.py`，找到 `plot_camera_ranking` 方法，将中文标签改为英文：

```python
# 原来的代码（第407-408行）
ax.set_xlabel('照片数量', fontsize=12, fontproperties=font_prop)
ax.set_title(f'相机使用排行 (Top {limit})', fontsize=16, fontweight='bold', fontproperties=font_prop)

# 改为：
ax.set_xlabel('Photo Count', fontsize=12)
ax.set_title(f'Camera Ranking (Top {limit})', fontsize=16, fontweight='bold')
```

---

## 验证方法

### 1. 查看生成的图片

用图片查看器打开：
```bash
# Linux
eog python/data/analysis/camera_ranking.png

# macOS
open python/data/analysis/camera_ranking.png
```

### 2. 检查字体

```bash
# 列出系统中的中文字体
fc-list :lang=zh | grep -i "wqy\|droid\|noto"

# 查看 matplotlib 可用字体
python -c "
import matplotlib.font_manager as fm
fonts = [f.name for f in fm.fontManager.ttflist if 'zh' in f.name.lower() or 'chinese' in f.name.lower() or 'cjk' in f.name.lower()]
print('可用中文字体:')
for font in set(fonts):
    print(f'  - {font}')
"
```

---

## 当前状态

### 已生成的图表

```bash
ls -lh python/data/analysis/camera_ranking.png
```

最新生成的图表位于：
```
/home/ben/gemini-work/gemini-t66y/python/data/analysis/camera_ranking.png
```

### 当前使用的字体

```
/usr/share/fonts/truetype/droid/DroidSansFallbackFull.ttf
```

虽然这个字体包含中文字符，但可能存在兼容性问题。

---

## 推荐操作步骤

1. **优先尝试方案 1**（如果有 sudo 权限）
2. **否则使用方案 3**（手动下载字体）
3. **临时使用方案 2**（修复脚本）
4. **最后考虑方案 4**（改用英文）

---

## 相关文件

- 修复脚本：`python/fix_camera_ranking.py`
- 核心代码：`python/src/analysis/time_analyzer.py`
- 字体配置：`python/src/utils/font_config.py`
- 输出目录：`python/data/analysis/`

---

## 技术说明

### 为什么其他图表正常？

其他图表（月度趋势、时间热力图）在代码中已经正确配置了字体，但相机排行图的字体配置可能不够完善。

### Droid Sans Fallback 的问题

这个字体虽然包含 CJK 字符（中日韩统一表意文字），但：
1. 某些字形可能不完整
2. matplotlib 在使用时可能有兼容性问题
3. 字体回退（fallback）机制可能不完善

### 文泉驿字体的优势

- 开源免费
- 专门为中文优化
- 字形完整
- matplotlib 兼容性好
- Linux 系统常用

---

*生成日期: 2026-02-15*
*作者: Claude Sonnet 4.5*
